import{h as f,a1 as se,g as p,d as ve,M as R,x as k,a2 as D,a3 as ze,a4 as He,a5 as c,T as de,a6 as E,U as Re}from"./framework.58dd4f08.js";const fe="vue-stage-play-global",pe="vue-stage-play-spotlight",ge={spotlightPadding:10,spotlightBorderRadius:10,spotlightDarkZoneColor:"rgba(66, 66, 66, 0.5)",allowInteract:!1,allowLeave:!0,cameraFollow:!0,cameraFollowOffset:24,cameraFollowOptions:{behavior:"smooth",block:"start",inline:"nearest"},cameraFixAfterFollow:!1,voiceOverPlacement:"bottom",voiceOverAutoPlacement:!0,voiceOverAlign:"center",voiceOverWidth:300,voiceOverTitle:"Hamlet Act 3 Scene 2",voiceOverContent:"To be, or not to be; that's the question.",voiceOverPrevButtonText:"Back",voiceOverNextButtonText:"Next",voiceOverDoneButtonText:"Done",onBeforeCut:()=>{},onAfterCut:()=>{},onActivated:()=>{},onDeactivated:()=>{}},B=f(!1);function he(){const t=window.scrollY,e=window.scrollX;document.body.style.position="fixed",document.body.style.top=`-${t}px`,document.body.style.left=`-${e}px`,document.body.style.width="100%"}function ye(){const t=document.body.style.top,e=document.body.style.left;document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.width="auto",window.scrollTo(parseInt(e||"0")*-1,parseInt(t||"0")*-1)}function xe(){ye(),he()}function De(){B.value||(B.value=!0,window.addEventListener("resize",xe),he())}function Ee(){B.value&&(B.value=!1,window.removeEventListener("resize",xe),ye())}function W(){return{isFixed:B,fixed:De,reset:Ee}}const S="[Vue Stage Play]",h={alreadyPlayingAct:t=>`${S} "${t}" is already playing.`,noSceneInAct:t=>`${S} No scene in "${t}"`,noSpecifiedSceneInAct:(t,e)=>`${S} No scene "${e}" in "${t}"`,noPlayingAct:()=>`${S} No playing act.`,noPreviousScene:()=>`${S} No previous scene.`,noNextScene:()=>`${S} No next scene.`,noSpecifiedScene:()=>`${S} No such scene`,sceneNumberShouldBePositive:()=>`${S} Scene number should be positive`,canNotRemoveCurrentScene:()=>`${S} Can't remove current scene`};function We(t,e,n){const r=t.length;if(r===0)return-1;let l=r-1;for(;l>=0;){if(e.call(n,t[l],l,t))return l;l--}return-1}function je(t,e){return new Promise(n=>{let r=0,l;t.scrollIntoView(e),requestAnimationFrame(s);function s(){const u=t.getBoundingClientRect().top;if(u===l){if(r++>2)return n()}else r=0,l=u;requestAnimationFrame(s)}})}function Me(t,e){let n="",r="",l="",s="",u="";switch(t){case"center":n="50%",l="50%",u="translate(-50%, -50%)";break;case"top":switch(n="0",l="0",u="translate(0, -100%)",e){case"start":l="0";break;case"center":l="50%",u="translate(-50%, -100%)";break;case"end":l="unset",s="0";break}break;case"bottom":switch(r="0",l="0",u="translate(0, 100%)",e){case"start":l="0";break;case"center":l="50%",u="translate(-50%, 100%)";break;case"end":l="unset",s="0";break}break;case"left":switch(n="0",l="0",u="translate(-100%, 0)",e){case"start":n="0";break;case"center":n="50%",u="translate(-100%, -50%)";break;case"end":n="unset",r="0";break}break;case"right":switch(n="0",s="0",u="translate(100%, 0)",e){case"start":n="0";break;case"center":n="50%",u="translate(100%, -50%)";break;case"end":n="unset",r="0";break}break}return{top:n,bottom:r,left:l,right:s,transform:u}}const{reset:Je}=W(),x=se({}),m=f(),d=p(()=>m.value?x[m.value]?x[m.value]:[]:[]),j=p(()=>d.value?d.value.map((t,e)=>t!==void 0?e:void 0).filter(t=>t!==void 0):[]),F=p(()=>!d.value||!v.value?-1:j.value.findIndex(t=>t===v.value)),v=f(),me=p(()=>{if(!m.value||!d.value.length||v.value===void 0)return;const t=d.value[v.value];return t!==void 0?t.value:void 0}),M=p(()=>d.value?d.value.filter(t=>t!==void 0).length:0),J=p(()=>F.value-1>=0),X=p(()=>F.value+1<M.value);function be(t,e){if(m.value){console.warn(h.alreadyPlayingAct(m.value));return}const n=x[t],r=Array.isArray(n)?n:[];if(r.length===0){console.warn(h.noSceneInAct(t));return}if(e!==void 0&&!r[e]){console.warn(h.noSpecifiedSceneInAct(t,e));return}m.value=t,v.value=e!==void 0?e:r.findIndex(l=>l!==void 0)}function Se(){m.value=void 0,v.value=void 0,Je()}function Xe(t,e,n){if(e<0)throw new Error(h.sceneNumberShouldBePositive());x[t]||(x[t]=[]);const r=x[t];Array.isArray(r)&&(r[e]=n)}function Ye(t,e){if(!x[t])return;if(v.value===e){console.warn(h.canNotRemoveCurrentScene());return}const n=x[t];Array.isArray(n)&&(n[e]=void 0)}function we(){const t=v.value;if(!d.value||t===void 0){console.warn(h.noPlayingAct());return}if(!J.value){console.warn(h.noPreviousScene());return}v.value=We(d.value,(e,n)=>n<t&&e!==void 0)}function _e(){const t=v.value;if(!d.value||t===void 0){console.warn(h.noPlayingAct());return}if(!X.value){console.warn(h.noNextScene());return}v.value=d.value.findIndex((e,n)=>n>t&&e!==void 0)}function Oe(t){if(!d.value||v.value===void 0){console.warn(h.noPlayingAct());return}if(d.value[t]===void 0){console.warn(h.noSpecifiedScene());return}v.value=t}const Ze=f(!0);function Ue(){return{acts:x,currentActName:m,currentActSceneList:j,totalSceneCount:M,currentScene:v,currentSceneOrder:F,currentActor:me,hasPrevScene:J,hasNextScene:X,action:be,cut:Se,prevScene:we,nextScene:_e,jumpToScene:Oe}}function ke(){return{isLocate:Ze,acts:x,currentActName:m,currentActSceneList:j,totalSceneCount:M,currentScene:v,currentSceneOrder:F,currentActor:me,hasPrevScene:J,hasNextScene:X,action:be,cut:Se,addScene:Xe,removeScene:Ye,prevScene:we,nextScene:_e,jumpToScene:Oe}}function ce(){return[{opacity:0},{opacity:1}]}function ue(t,e,n,r){const l=t.animate(n,r);l.onfinish=()=>{e()}}function Pe(t){function e(r,l){const s=ce();ue(r,l,s,{duration:t,easing:"ease"})}function n(r,l){const s=ce().reverse();ue(r,l,s,{duration:t,easing:"ease"})}return{enterTransition:e,leaveTransition:n}}const Ke=ve({slots:Object,name:"StagePlayScene",props:{actName:{type:String,required:!0},scene:{type:Number,required:!0,validator:t=>t>=0},tag:{type:String,required:!1,default:"div"},skip:{type:Boolean,required:!1,default:!1},allowInteract:{type:Boolean,required:!1,default:void 0},allowLeave:{type:Boolean,required:!1,default:void 0},cameraFollow:{type:Boolean,required:!1,default:void 0},cameraFollowOffset:{type:Number,required:!1},cameraFollowOptions:{type:Object,required:!1},cameraFixAfterFollow:{type:Boolean,required:!1,default:void 0},voiceOverPlacement:{type:String,required:!1},voiceOverAutoPlacement:{type:Boolean,required:!1,default:void 0},voiceOverAlign:{type:String,required:!1},voiceOverWidth:{type:Number,required:!1},voiceOverTitle:{type:String,required:!1},voiceOverContent:{type:String,required:!1},voiceOverPrevButtonText:{type:String,required:!1},voiceOverNextButtonText:{type:String,required:!1},voiceOverDoneButtonText:{type:String,required:!1},onBeforeCut:{type:Function,required:!1},onAfterCut:{type:Function,required:!1},onActivated:{type:Function,required:!1},onDeactivated:{type:Function,required:!1}},setup(t,{slots:e}){const n=f(null),r=f(null),{fixed:l,reset:s}=W(),{enterTransition:u}=Pe(250),I=R(fe,{}),N=R(pe),b=f({}),a=p(()=>({...ge,...I,...N,...b.value,actName:t.actName,scene:t.scene,skip:t.skip,tag:t.tag}));function $(o={}){const i={...o};for(const O in i)i[O]===void 0&&delete i[O];b.value=i}k(()=>t,async()=>{const{actName:o,scene:i,skip:O,tag:H,...T}=t;$(T)},{deep:!0,immediate:!0});const{isLocate:_,currentActName:P,currentActSceneList:C,currentScene:q,currentSceneOrder:w,currentActor:Ae,hasPrevScene:Y,hasNextScene:L,totalSceneCount:Z,action:Be,cut:Ne,addScene:$e,removeScene:G,prevScene:U,nextScene:K,jumpToScene:Ce}=ke(),y=p(()=>P.value===a.value.actName&&q.value===a.value.scene);function qe(o,i){Be(o||a.value.actName,i)}async function A(){await a.value.onBeforeCut(g),Ne(),await a.value.onAfterCut(g)}const g=se({actName:a.value.actName,scene:a.value.scene,currentActName:P,currentActSceneList:C,currentScene:q,currentSceneOrder:w,currentActor:Ae,hasPrevScene:Y,hasNextScene:L,totalSceneCount:Z,isCurrentScene:y,action:qe,cut:A,prevScene:U,nextScene:K,jumpToScene:Ce}),{top:Q,bottom:V,left:ee,right:te}=D(n),{width:oe,height:ne}=D(r),{width:ae,height:ie}=ze(),Te=p(()=>{if(e.default===void 0)return"center";if(!a.value.voiceOverAutoPlacement)return a.value.voiceOverPlacement;let o=[];switch(a.value.voiceOverPlacement){case"top":o=["top","bottom","left","right"];break;case"bottom":o=["bottom","top","left","right"];break;case"left":o=["left","top","bottom","right"];break;case"right":o=["right","top","bottom","left"];break}return V.value+ne.value>ie.value&&(o=o.filter(i=>i!=="bottom")),Q.value-ne.value<0&&(o=o.filter(i=>i!=="top")),ee.value-oe.value<0&&(o=o.filter(i=>i!=="left")),te.value+oe.value>ae.value&&(o=o.filter(i=>i!=="right")),(Q.value<0||V.value>ie.value)&&(o=o.filter(i=>i!=="right"&&i!=="left")),(ee.value<0||te.value>ae.value)&&(o=o.filter(i=>i!=="top"&&i!=="bottom")),o[0]||a.value.voiceOverPlacement});k(()=>({actName:a.value.actName,scene:a.value.scene,skip:a.value.skip}),(o,i)=>{JSON.stringify(o)!==JSON.stringify(i)&&(i!=null&&i.actName&&(i!=null&&i.scene)&&G(i.actName,i.scene),o!=null&&o.actName&&(o!=null&&o.scene)&&!(o!=null&&o.skip)&&$e(o.actName,o.scene,n))},{deep:!0,immediate:!0}),k(y,async o=>{o?await a.value.onActivated(g):await a.value.onDeactivated(g)}),k(_,async o=>{s(),!o&&y.value&&a.value.cameraFollow&&n.value&&(await je(n.value,a.value.cameraFollowOptions),a.value.cameraFixAfterFollow&&l())}),He(()=>{y.value&&A(),G(a.value.actName,a.value.scene)});const z=f(!1),Fe=f(!1),Ie=f(!1),Le=f(!1);return()=>{var o;return c(a.value.tag,{class:"vue-stage-play__scene",style:{position:e.default?y.value?"relative":void 0:"fixed",top:e.default?void 0:"50%",left:e.default?void 0:"50%",zIndex:e.default?y.value?"99998":void 0:"99998",transform:e.default?void 0:"translate(-50%, -50%)"}},[(o=e.default)==null?void 0:o.call(e,g),c("div",{id:`vue-stage-play__spotlight-${a.value.actName}-${a.value.scene}`,class:"vue-stage-play__spotlight",ref:n,style:{position:"absolute",scrollMargin:`${a.value.cameraFollowOffset}px`,top:e.default?`-${a.value.spotlightPadding||0}px`:"-1px",bottom:e.default?`-${a.value.spotlightPadding||0}px`:"-1px",left:e.default?`-${a.value.spotlightPadding||0}px`:"-1px",right:e.default?`-${a.value.spotlightPadding||0}px`:"-1px",pointerEvents:y.value&&!a.value.allowInteract?void 0:"none"}},[c(de,{css:!1,onEnter:u},()=>{var i,O,H,T,re,le;return[y.value&&!_.value?c("div",{class:"vue-stage-play__voice-over",style:{position:"absolute",zIndex:"99996",color:"#292929",pointerEvents:"auto",...Me(Te.value,a.value.voiceOverAlign)},ref:r},[((i=e.voiceOver)==null?void 0:i.call(e,g))||c("div",{class:"default__voice-over",style:{width:`${a.value.voiceOverWidth}px`,margin:"8px",borderRadius:"8px",boxShadow:"0 0 8px rgba(0, 0, 0, 0.2)",backgroundColor:"#fff"}},[c("div",{class:"default__voice-over__header",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:"1px solid #ddd",fontSize:"16px",fontWeight:"bold",lineHeight:"1"}},[((O=e.voHeader)==null?void 0:O.call(e,g))||c("div",{class:"default__voice-over__header__content",style:{flexGrow:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:"1.5"}},a.value.voiceOverTitle),((H=e.voCloseIcon)==null?void 0:H.call(e,g))||c("svg",{class:"default__voice-over__header__close",style:{position:"relative",flexShrink:"0",right:"-4px",display:"block",width:"24px",height:"24px",color:z.value?"#292929":"#7e7e7e",cursor:"pointer",transition:"all 0.2s ease-in-out"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",onMouseenter:()=>{z.value=!0},onMouseleave:()=>{z.value=!1},onClick:()=>A()},[c("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})])]),c("div",{class:"default__voice-over__body",style:{position:"relative",boxSizing:"border-box",minHeight:"60px",padding:"12px",fontSize:"14px",lineHeight:"1.5",textAlign:"center",whiteSpace:"pre-wrap"}},[((T=e.voBody)==null?void 0:T.call(e,g))||a.value.voiceOverContent]),c("div",{class:"default__voice-over__footer",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderTop:"1px solid #ddd"}},[((re=e.voFooter)==null?void 0:re.call(e,g))||c("div",{class:"default__voice-over__footer__scene",style:{fontSize:"14px",color:"#7e7e7e"}},`${w.value+1} / ${Z.value}`),((le=e.voFooterButton)==null?void 0:le.call(e,g))||c("div",{class:"default__voice-over__footer__btns",style:{display:"flex",gap:"8px"}},[Y.value&&c("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Fe.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>U()},a.value.voiceOverPrevButtonText),L.value&&c("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Ie.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>K()},a.value.voiceOverNextButtonText),!L.value&&c("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Le.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>A()},a.value.voiceOverDoneButtonText)])])])]):void 0]})]),y.value&&_.value?c(E,{to:"body"},[c("div",{class:"vue-stage-play__scroll-mask",style:{position:"fixed",top:"0",left:"0",width:"150vw",height:"100vh",zIndex:"99999",overflow:"auto",overscrollBehavior:"none"}},[c("div",{style:{width:"100%",height:"300%"}})])]):void 0,y.value?c(E,{to:"body"},[c("div",{class:"vue-stage-play__click-mask",style:{position:"fixed",top:0,left:0,zIndex:99997,width:"100vw",height:"100vh"},onClick:()=>{a.value.allowLeave&&A()}})]):void 0])}}}),Qe=ve({name:"StagePlaySpotlight",props:{spotlightPadding:{type:Number,required:!1},spotlightBorderRadius:{type:Number,required:!1},spotlightDarkZoneColor:{type:String,required:!1}},setup(t,{slots:e}){const{isLocate:n,currentActor:r}=ke(),{enterTransition:l,leaveTransition:s}=Pe(600),{isFixed:u}=W(),I=R(fe,{}),N=f({}),b=p(()=>({...ge,...I,...N.value}));function a(w={}){N.value=JSON.parse(JSON.stringify(w))}k(()=>t,()=>{a(t)},{deep:!0,immediate:!0}),Re(pe,{spotlightPadding:b.value.spotlightPadding});const{top:$,left:_,width:P,height:C}=D(r);k(r,()=>{n.value=!0});const q=p(()=>({position:"absolute",zIndex:99995,top:u.value?`calc(-1 * ${document.body.style.top} + ${$.value}px)`:`calc(${window.scrollY}px + ${$.value}px)`,left:u.value?`calc(-1 * ${document.body.style.left} + ${_.value}px)`:`calc(${window.scrollX}px + ${_.value}px)`,width:P.value?P.value+"px":"100%",height:C.value?C.value+"px":"100%",borderRadius:`${b.value.spotlightBorderRadius}px ${b.value.spotlightBorderRadius}px ${b.value.spotlightBorderRadius}px ${b.value.spotlightBorderRadius-.001}px`,boxShadow:`${b.value.spotlightDarkZoneColor} 0px 0px 0px 3000px`,transition:n.value?"all 0.35s ease":void 0,pointerEvents:"none"}));return()=>{var w;return[(w=e.default)==null?void 0:w.call(e),c(E,{to:"body"},c(de,{css:!1,onEnter:l,onLeave:s},()=>[r!=null&&r.value?c("div",{class:"vue-stage-play__spotlight-bulb",style:q.value,onTransitionend:()=>{n.value=!1}}):null]))]}}});export{Ke as S,Qe as a,Ue as u};
