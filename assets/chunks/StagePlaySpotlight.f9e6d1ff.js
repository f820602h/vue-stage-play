import{h as p,a1 as ue,g as d,d as se,M as D,x as P,a2 as E,a3 as Re,a4 as De,a5 as l,T as ce,a6 as W,U as Ee,a7 as We}from"./framework.19c5b41e.js";const ve="vue-stage-play-global",de="vue-stage-play-spotlight",fe={spotlightPadding:10,spotlightBorderRadius:10,spotlightDarkZoneColor:"rgba(66, 66, 66, 0.5)",allowInteract:!1,allowLeave:!0,cameraFollow:!0,cameraFollowOffset:24,cameraFollowOptions:{behavior:"smooth",block:"start",inline:"nearest"},cameraFixAfterFollow:!0,voiceOverPlacement:"bottom",voiceOverAutoPlacement:!0,voiceOverAlign:"center",voiceOverWidth:300,voiceOverTitle:"Hamlet Act 3 Scene 2",voiceOverContent:"To be, or not to be; that's the question.",voiceOverPrevButtonText:"Back",voiceOverNextButtonText:"Next",voiceOverDoneButtonText:"Done",onBeforeCut:()=>{},onAfterCut:()=>{},onActivated:()=>{},onDeactivated:()=>{}},I=p(!1);function pe(){const e=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${e}px`,document.body.style.width="100%"}function ge(){const e=document.body.style.top;document.body.style.position="",document.body.style.top="",document.body.style.width="auto",window.scrollTo(0,parseInt(e||"0")*-1)}function he(){ge(),pe()}function je(){I.value||(I.value=!0,window.addEventListener("resize",he),pe())}function Me(){I.value&&(I.value=!1,window.removeEventListener("resize",he),ge())}function ye(){return{fixed:je,reset:Me}}const _="[Vue Stage Play]",y={alreadyPlayingAct:e=>`${_} "${e}" is already playing.`,noSceneInAct:e=>`${_} No scene in "${e}"`,noSpecifiedSceneInAct:(e,o)=>`${_} No scene "${o}" in "${e}"`,noPlayingAct:()=>`${_} No playing act.`,noPreviousScene:()=>`${_} No previous scene.`,noNextScene:()=>`${_} No next scene.`,noSpecifiedScene:()=>`${_} No such scene`,sceneNumberShouldBePositive:()=>`${_} Scene number should be positive`,canNotRemoveCurrentScene:()=>`${_} Can't remove current scene`};function Je(e,o,i){const r=e.length;if(r===0)return-1;let s=r-1;for(;s>=0;){if(o.call(i,e[s],s,e))return s;s--}return-1}const{reset:Ze}=ye(),m=ue({}),x=p(),f=d(()=>x.value?m[x.value]?m[x.value]:[]:[]),j=d(()=>f.value?f.value.map((e,o)=>e!==void 0?o:void 0).filter(e=>e!==void 0):[]),L=d(()=>!f.value||!v.value?-1:j.value.findIndex(e=>e===v.value)),v=p(),me=d(()=>{if(!x.value||!f.value.length||v.value===void 0)return;const e=f.value[v.value];return e!==void 0?e.value:void 0}),M=d(()=>f.value?f.value.filter(e=>e!==void 0).length:0),J=d(()=>L.value-1>=0),Z=d(()=>L.value+1<M.value);function xe(e,o){if(x.value){console.warn(y.alreadyPlayingAct(x.value));return}const i=m[e],r=Array.isArray(i)?i:[];if(r.length===0){console.warn(y.noSceneInAct(e));return}if(o!==void 0&&!r[o]){console.warn(y.noSpecifiedSceneInAct(e,o));return}x.value=e,v.value=o!==void 0?o:r.findIndex(s=>s!==void 0)}function be(){x.value=void 0,v.value=void 0,Ze()}function Ge(e,o,i){if(o<0)throw new Error(y.sceneNumberShouldBePositive());m[e]||(m[e]=[]);const r=m[e];Array.isArray(r)&&(r[o]=i)}function Ue(e,o){if(!m[e])return;if(v.value===o){console.warn(y.canNotRemoveCurrentScene());return}const i=m[e];Array.isArray(i)&&(i[o]=void 0)}function Se(){const e=v.value;if(!f.value||e===void 0){console.warn(y.noPlayingAct());return}if(!J.value){console.warn(y.noPreviousScene());return}v.value=Je(f.value,(o,i)=>i<e&&o!==void 0)}function we(){const e=v.value;if(!f.value||e===void 0){console.warn(y.noPlayingAct());return}if(!Z.value){console.warn(y.noNextScene());return}v.value=f.value.findIndex((o,i)=>i>e&&o!==void 0)}function _e(e){if(!f.value||v.value===void 0){console.warn(y.noPlayingAct());return}if(f.value[e]===void 0){console.warn(y.noSpecifiedScene());return}v.value=e}const Ye=p(!0);function Qe(){return{acts:m,currentActName:x,currentActSceneList:j,totalSceneCount:M,currentScene:v,currentSceneOrder:L,currentActor:me,hasPrevScene:J,hasNextScene:Z,action:xe,cut:be,prevScene:Se,nextScene:we,jumpToScene:_e}}function Oe(){return{isFloat:Ye,acts:m,currentActName:x,currentActSceneList:j,currentScene:v,currentSceneOrder:L,currentActor:me,hasPrevScene:J,hasNextScene:Z,totalSceneCount:M,action:xe,cut:be,addScene:Ge,removeScene:Ue,prevScene:Se,nextScene:we,jumpToScene:_e}}function re(){return[{opacity:0},{opacity:1}]}function le(e,o,i,r){const s=e.animate(i,r);s.onfinish=()=>{o()}}function ke(e){function o(r,s){const O=re();le(r,s,O,{duration:e,easing:"ease"})}function i(r,s){const O=re().reverse();le(r,s,O,{duration:e,easing:"ease"})}return{enterTransition:o,leaveTransition:i}}const Xe=se({slots:Object,name:"StagePlayScene",props:{actName:{type:String,required:!0},scene:{type:Number,required:!0,validator:e=>e>=0},tag:{type:String,required:!1,default:"div"},skip:{type:Boolean,required:!1,default:!1},allowInteract:{type:Boolean,required:!1,default:void 0},allowLeave:{type:Boolean,required:!1,default:void 0},cameraFollow:{type:Boolean,required:!1,default:void 0},cameraFollowOffset:{type:Number,required:!1},cameraFollowOptions:{type:Object,required:!1},cameraFixAfterFollow:{type:Boolean,required:!1,default:void 0},voiceOverPlacement:{type:String,required:!1},voiceOverAutoPlacement:{type:Boolean,required:!1,default:void 0},voiceOverAlign:{type:String,required:!1},voiceOverWidth:{type:Number,required:!1},voiceOverTitle:{type:String,required:!1},voiceOverContent:{type:String,required:!1},voiceOverPrevButtonText:{type:String,required:!1},voiceOverNextButtonText:{type:String,required:!1},voiceOverDoneButtonText:{type:String,required:!1},onBeforeCut:{type:Function,required:!1},onAfterCut:{type:Function,required:!1},onActivated:{type:Function,required:!1},onDeactivated:{type:Function,required:!1}},setup(e,{slots:o}){const i=p(null),r=p(null),{enterTransition:s,leaveTransition:O}=ke(250),A=D(ve,{}),T=D(de),b=p({}),n=d(()=>({...fe,...A,...T,...b.value,actName:e.actName,scene:e.scene,skip:e.skip,tag:e.tag}));function z(t={}){const a={...t};for(const u in a)a[u]===void 0&&delete a[u];b.value=a}P(()=>e,async()=>{const{actName:t,scene:a,skip:u,tag:h,...c}=e;z(c)},{deep:!0,immediate:!0});const{isFloat:B,currentActName:N,currentActSceneList:q,currentScene:S,currentSceneOrder:F,hasPrevScene:k,hasNextScene:H,totalSceneCount:G,action:Pe,cut:Ae,addScene:Be,removeScene:U,prevScene:Y,nextScene:K,jumpToScene:Ne}=Oe(),w=d(()=>N.value===n.value.actName&&S.value===n.value.scene),g=ue({currentActName:N,currentActSceneList:q,currentScene:S,currentSceneOrder:F,hasPrevScene:k,hasNextScene:H,totalSceneCount:G,isCurrentScene:w,action:Ce,cut:C,prevScene:Y,nextScene:K,jumpToScene:Ne});function Ce(t,a){Pe(t||n.value.actName,a)}async function C(){await n.value.onBeforeCut(g),Ae(),await n.value.onAfterCut(g)}const{top:Q,bottom:X,left:V,right:ee}=E(i),{width:te,height:oe}=E(r),{width:ne,height:ae}=Re(),$e=d(()=>{if(!n.value.voiceOverAutoPlacement)return n.value.voiceOverPlacement;let t=[];switch(n.value.voiceOverPlacement){case"top":t=["top","bottom","left","right"];break;case"bottom":t=["bottom","top","left","right"];break;case"left":t=["left","top","bottom","right"];break;case"right":t=["right","top","bottom","left"];break}return X.value+oe.value>ae.value&&(t=t.filter(a=>a!=="bottom")),Q.value-oe.value<0&&(t=t.filter(a=>a!=="top")),V.value-te.value<0&&(t=t.filter(a=>a!=="left")),ee.value+te.value>ne.value&&(t=t.filter(a=>a!=="right")),(Q.value<0||X.value>ae.value)&&(t=t.filter(a=>a!=="right"&&a!=="left")),(V.value<0||ee.value>ne.value)&&(t=t.filter(a=>a!=="top"&&a!=="bottom")),t[0]||n.value.voiceOverPlacement}),{fixed:Te,reset:qe}=ye();function Fe(t){return new Promise(a=>{let u=0,h;t.scrollIntoView(n.value.cameraFollowOptions),requestAnimationFrame(c);function c(){const $=t.getBoundingClientRect().top;if($===h){if(u++>2)return a()}else u=0,h=$;requestAnimationFrame(c)}})}P(()=>({actName:n.value.actName,scene:n.value.scene,skip:n.value.skip}),(t,a)=>{JSON.stringify(t)!==JSON.stringify(a)&&(a!=null&&a.actName&&(a!=null&&a.scene)&&U(a.actName,a.scene),t!=null&&t.actName&&(t!=null&&t.scene)&&!(t!=null&&t.skip)&&Be(t.actName,t.scene,i))},{deep:!0,immediate:!0}),P(w,async t=>{t?await n.value.onActivated(g):await n.value.onDeactivated(g)}),P(B,async t=>{qe(),!t&&w.value&&n.value.cameraFollow&&i.value&&(await Fe(i.value),n.value.cameraFixAfterFollow&&Te())}),De(()=>{w.value&&C(),U(n.value.actName,n.value.scene)});const Ie=d(()=>{let t="",a="",u="",h="",c="";switch($e.value){case"top":switch(t="0",u="0",c="translate(0, -100%)",n.value.voiceOverAlign){case"start":u="0";break;case"center":u="50%",c="translate(-50%, -100%)";break;case"end":u="unset",h="0";break}break;case"bottom":switch(a="0",u="0",c="translate(0, 100%)",n.value.voiceOverAlign){case"start":u="0";break;case"center":u="50%",c="translate(-50%, 100%)";break;case"end":u="unset",h="0";break}break;case"left":switch(t="0",u="0",c="translate(-100%, 0)",n.value.voiceOverAlign){case"start":t="0";break;case"center":t="50%",c="translate(-100%, -50%)";break;case"end":t="unset",a="0";break}break;case"right":switch(t="0",h="0",c="translate(100%, 0)",n.value.voiceOverAlign){case"start":t="0";break;case"center":t="50%",c="translate(100%, -50%)";break;case"end":t="unset",a="0";break}break}return{position:"absolute",zIndex:"99996",color:"#292929",pointerEvents:"auto",top:t,bottom:a,left:u,right:h,transform:c}}),R=p(!1),Le=p(!1),ze=p(!1),He=p(!1);return()=>{var t;return l(n.value.tag,{class:"vue-stage-play__scene",style:{position:"relative",zIndex:w.value?"99998":""}},[(t=o.default)==null?void 0:t.call(o,g),l("div",{id:`vue-stage-play__spotlight-${n.value.actName}-${n.value.scene}`,class:"vue-stage-play__spotlight",ref:i,style:{position:"absolute",scrollMargin:`${n.value.cameraFollowOffset}px`,top:`-${n.value.spotlightPadding||0}px`,bottom:`-${n.value.spotlightPadding||0}px`,left:`-${n.value.spotlightPadding||0}px`,right:`-${n.value.spotlightPadding||0}px`,pointerEvents:w.value&&!n.value.allowInteract?void 0:"none"}},[l(ce,{css:!1,onEnter:s,onLeave:O},()=>{var a,u,h,c,$,ie;return[w.value&&!B.value?l("div",{class:"vue-stage-play__voice-over",style:Ie.value,ref:r},[((a=o.voiceOver)==null?void 0:a.call(o,g))||l("div",{class:"default__voice-over",style:{width:`${n.value.voiceOverWidth}px`,margin:"8px",borderRadius:"8px",boxShadow:"0 0 8px rgba(0, 0, 0, 0.2)",backgroundColor:"#fff"}},[l("div",{class:"default__voice-over__header",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:"1px solid #ddd",fontSize:"16px",fontWeight:"bold",lineHeight:"1"}},[((u=o.voHeader)==null?void 0:u.call(o,g))||l("div",{class:"default__voice-over__header__content",style:{flexGrow:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},n.value.voiceOverTitle),((h=o.voCloseIcon)==null?void 0:h.call(o,g))||l("svg",{class:"default__voice-over__header__close",style:{position:"relative",flexShrink:"0",right:"-4px",display:"block",width:"24px",height:"24px",color:R.value?"#292929":"#7e7e7e",cursor:"pointer",transition:"all 0.2s ease-in-out"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",onMouseenter:()=>{R.value=!0},onMouseleave:()=>{R.value=!1},onClick:()=>C()},[l("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})])]),l("div",{class:"default__voice-over__body",style:{position:"relative",boxSizing:"border-box",minHeight:"60px",padding:"12px",fontSize:"14px",lineHeight:"1.5",textAlign:"center",whiteSpace:"pre-wrap"}},[((c=o.voBody)==null?void 0:c.call(o,g))||n.value.voiceOverContent]),l("div",{class:"default__voice-over__footer",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderTop:"1px solid #ddd"}},[(($=o.voFooter)==null?void 0:$.call(o,g))||l("div",{class:"default__voice-over__footer__scene",style:{fontSize:"14px",color:"#7e7e7e"}},`${F.value+1} / ${G.value}`),((ie=o.voFooterButton)==null?void 0:ie.call(o,g))||l("div",{class:"default__voice-over__footer__btns",style:{display:"flex",gap:"8px"}},[k.value&&l("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Le.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>Y()},n.value.voiceOverPrevButtonText),H.value&&l("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:ze.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>K()},n.value.voiceOverNextButtonText),!H.value&&l("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:He.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>C()},n.value.voiceOverDoneButtonText)])])])]):void 0]})]),w.value&&B.value?l(W,{to:"body"},[l("div",{class:"vue-stage-play__scroll-mask",style:{position:"fixed",top:"0",left:"0",width:"150vw",height:"100vh",zIndex:"99999",overflow:"auto",overscrollBehavior:"none"}},[l("div",{style:{width:"100%",height:"300%"}})])]):void 0,w.value?l(W,{to:"body"},[l("div",{class:"vue-stage-play__click-mask",style:{position:"fixed",top:0,left:0,zIndex:99997,width:"100vw",height:"100vh"},onClick:()=>{n.value.allowLeave&&C()}})]):void 0])}}}),Ve=se({name:"StagePlaySpotlight",props:{spotlightPadding:{type:Number,required:!1},spotlightBorderRadius:{type:Number,required:!1},spotlightDarkZoneColor:{type:String,required:!1}},setup(e,{slots:o}){const{isFloat:i,currentActor:r}=Oe(),{enterTransition:s,leaveTransition:O}=ke(600),A=D(ve,{}),T=p({}),b=d(()=>({...fe,...A,...T.value}));function n(k={}){T.value=JSON.parse(JSON.stringify(k))}P(()=>e,()=>{n(e)},{deep:!0,immediate:!0}),Ee(de,{spotlightPadding:b.value.spotlightPadding});const{top:z,left:B,width:N,height:q}=E(r);P(r,()=>{i.value=!0});const S=We?document.documentElement||document.body:void 0,F=d(()=>({position:"absolute",zIndex:99995,top:!i.value&&r.value?"0px":`${z.value+((S==null?void 0:S.scrollTop)||0)}px`,left:!i.value&&r.value?"0px":`${B.value+((S==null?void 0:S.scrollLeft)||0)}px`,width:N.value?N.value+"px":"100%",height:q.value?q.value+"px":"100%",borderRadius:`${b.value.spotlightBorderRadius}px ${b.value.spotlightBorderRadius}px ${b.value.spotlightBorderRadius}px ${b.value.spotlightBorderRadius-.001}px`,boxShadow:`${b.value.spotlightDarkZoneColor} 0px 0px 0px 3000px`,transition:"all 0.35s ease",pointerEvents:"none"}));return()=>{var k;return[(k=o.default)==null?void 0:k.call(o),l(W,{to:!i.value&&(r==null?void 0:r.value)||"body"},l(ce,{css:!1,onEnter:s,onLeave:O},()=>[r!=null&&r.value?l("div",{class:"vue-stage-play__spotlight-bulb",style:F.value,onTransitionend:()=>{i.value=!1}}):null]))]}}});export{Xe as S,Ve as a,Qe as u};
