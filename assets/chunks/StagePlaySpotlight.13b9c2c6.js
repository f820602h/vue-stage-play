import{h as f,a1 as se,g as p,d as ve,M as R,x as P,a2 as D,a3 as He,a4 as Re,a5 as u,T as de,a6 as E,U as De,a7 as Ee}from"./framework.19c5b41e.js";const fe="vue-stage-play-global",pe="vue-stage-play-spotlight",ge={spotlightPadding:10,spotlightBorderRadius:10,spotlightDarkZoneColor:"rgba(66, 66, 66, 0.5)",allowInteract:!1,allowLeave:!0,cameraFollow:!0,cameraFollowOffset:24,cameraFollowOptions:{behavior:"smooth",block:"start",inline:"nearest"},cameraFixAfterFollow:!0,voiceOverPlacement:"bottom",voiceOverAutoPlacement:!0,voiceOverAlign:"center",voiceOverWidth:300,voiceOverTitle:"Hamlet Act 3 Scene 2",voiceOverContent:"To be, or not to be; that's the question.",voiceOverPrevButtonText:"Back",voiceOverNextButtonText:"Next",voiceOverDoneButtonText:"Done",onBeforeCut:()=>{},onAfterCut:()=>{},onActivated:()=>{},onDeactivated:()=>{}},T=f(!1);function he(){const t=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${t}px`,document.body.style.width="100%"}function ye(){const t=document.body.style.top;document.body.style.position="",document.body.style.top="",document.body.style.width="auto",window.scrollTo(0,parseInt(t||"0")*-1)}function xe(){ye(),he()}function We(){T.value||(T.value=!0,window.addEventListener("resize",xe),he())}function je(){T.value&&(T.value=!1,window.removeEventListener("resize",xe),ye())}function me(){return{fixed:We,reset:je}}const S="[Vue Stage Play]",h={alreadyPlayingAct:t=>`${S} "${t}" is already playing.`,noSceneInAct:t=>`${S} No scene in "${t}"`,noSpecifiedSceneInAct:(t,e)=>`${S} No scene "${e}" in "${t}"`,noPlayingAct:()=>`${S} No playing act.`,noPreviousScene:()=>`${S} No previous scene.`,noNextScene:()=>`${S} No next scene.`,noSpecifiedScene:()=>`${S} No such scene`,sceneNumberShouldBePositive:()=>`${S} Scene number should be positive`,canNotRemoveCurrentScene:()=>`${S} Can't remove current scene`};function Me(t,e,o){const i=t.length;if(i===0)return-1;let l=i-1;for(;l>=0;){if(e.call(o,t[l],l,t))return l;l--}return-1}function Je(t,e){return new Promise(o=>{let i=0,l;t.scrollIntoView(e),requestAnimationFrame(s);function s(){const c=t.getBoundingClientRect().top;if(c===l){if(i++>2)return o()}else i=0,l=c;requestAnimationFrame(s)}})}function Ze(t,e){let o="",i="",l="",s="",c="";switch(t){case"center":o="50%",l="50%",c="translate(-50%, -50%)";break;case"top":switch(o="0",l="0",c="translate(0, -100%)",e){case"start":l="0";break;case"center":l="50%",c="translate(-50%, -100%)";break;case"end":l="unset",s="0";break}break;case"bottom":switch(i="0",l="0",c="translate(0, 100%)",e){case"start":l="0";break;case"center":l="50%",c="translate(-50%, 100%)";break;case"end":l="unset",s="0";break}break;case"left":switch(o="0",l="0",c="translate(-100%, 0)",e){case"start":o="0";break;case"center":o="50%",c="translate(-100%, -50%)";break;case"end":o="unset",i="0";break}break;case"right":switch(o="0",s="0",c="translate(100%, 0)",e){case"start":o="0";break;case"center":o="50%",c="translate(100%, -50%)";break;case"end":o="unset",i="0";break}break}return{top:o,bottom:i,left:l,right:s,transform:c}}const{reset:Ge}=me(),x=se({}),m=f(),d=p(()=>m.value?x[m.value]?x[m.value]:[]:[]),W=p(()=>d.value?d.value.map((t,e)=>t!==void 0?e:void 0).filter(t=>t!==void 0):[]),q=p(()=>!d.value||!v.value?-1:W.value.findIndex(t=>t===v.value)),v=f(),be=p(()=>{if(!m.value||!d.value.length||v.value===void 0)return;const t=d.value[v.value];return t!==void 0?t.value:void 0}),j=p(()=>d.value?d.value.filter(t=>t!==void 0).length:0),M=p(()=>q.value-1>=0),J=p(()=>q.value+1<j.value);function Se(t,e){if(m.value){console.warn(h.alreadyPlayingAct(m.value));return}const o=x[t],i=Array.isArray(o)?o:[];if(i.length===0){console.warn(h.noSceneInAct(t));return}if(e!==void 0&&!i[e]){console.warn(h.noSpecifiedSceneInAct(t,e));return}m.value=t,v.value=e!==void 0?e:i.findIndex(l=>l!==void 0)}function we(){m.value=void 0,v.value=void 0,Ge()}function Ue(t,e,o){if(e<0)throw new Error(h.sceneNumberShouldBePositive());x[t]||(x[t]=[]);const i=x[t];Array.isArray(i)&&(i[e]=o)}function Ye(t,e){if(!x[t])return;if(v.value===e){console.warn(h.canNotRemoveCurrentScene());return}const o=x[t];Array.isArray(o)&&(o[e]=void 0)}function _e(){const t=v.value;if(!d.value||t===void 0){console.warn(h.noPlayingAct());return}if(!M.value){console.warn(h.noPreviousScene());return}v.value=Me(d.value,(e,o)=>o<t&&e!==void 0)}function Oe(){const t=v.value;if(!d.value||t===void 0){console.warn(h.noPlayingAct());return}if(!J.value){console.warn(h.noNextScene());return}v.value=d.value.findIndex((e,o)=>o>t&&e!==void 0)}function ke(t){if(!d.value||v.value===void 0){console.warn(h.noPlayingAct());return}if(d.value[t]===void 0){console.warn(h.noSpecifiedScene());return}v.value=t}const Ke=f(!0);function Xe(){return{acts:x,currentActName:m,currentActSceneList:W,totalSceneCount:j,currentScene:v,currentSceneOrder:q,currentActor:be,hasPrevScene:M,hasNextScene:J,action:Se,cut:we,prevScene:_e,nextScene:Oe,jumpToScene:ke}}function Pe(){return{isFloat:Ke,acts:x,currentActName:m,currentActSceneList:W,totalSceneCount:j,currentScene:v,currentSceneOrder:q,currentActor:be,hasPrevScene:M,hasNextScene:J,action:Se,cut:we,addScene:Ue,removeScene:Ye,prevScene:_e,nextScene:Oe,jumpToScene:ke}}function ue(){return[{opacity:0},{opacity:1}]}function ce(t,e,o,i){const l=t.animate(o,i);l.onfinish=()=>{e()}}function Be(t){function e(i,l){const s=ue();ce(i,l,s,{duration:t,easing:"ease"})}function o(i,l){const s=ue().reverse();ce(i,l,s,{duration:t,easing:"ease"})}return{enterTransition:e,leaveTransition:o}}const Ve=ve({slots:Object,name:"StagePlayScene",props:{actName:{type:String,required:!0},scene:{type:Number,required:!0,validator:t=>t>=0},tag:{type:String,required:!1,default:"div"},skip:{type:Boolean,required:!1,default:!1},allowInteract:{type:Boolean,required:!1,default:void 0},allowLeave:{type:Boolean,required:!1,default:void 0},cameraFollow:{type:Boolean,required:!1,default:void 0},cameraFollowOffset:{type:Number,required:!1},cameraFollowOptions:{type:Object,required:!1},cameraFixAfterFollow:{type:Boolean,required:!1,default:void 0},voiceOverPlacement:{type:String,required:!1},voiceOverAutoPlacement:{type:Boolean,required:!1,default:void 0},voiceOverAlign:{type:String,required:!1},voiceOverWidth:{type:Number,required:!1},voiceOverTitle:{type:String,required:!1},voiceOverContent:{type:String,required:!1},voiceOverPrevButtonText:{type:String,required:!1},voiceOverNextButtonText:{type:String,required:!1},voiceOverDoneButtonText:{type:String,required:!1},onBeforeCut:{type:Function,required:!1},onAfterCut:{type:Function,required:!1},onActivated:{type:Function,required:!1},onDeactivated:{type:Function,required:!1}},setup(t,{slots:e}){const o=f(null),i=f(null),{fixed:l,reset:s}=me(),{enterTransition:c,leaveTransition:A}=Be(250),w=R(fe,{}),F=R(pe),N=f({}),a=p(()=>({...ge,...w,...F,...N.value,actName:t.actName,scene:t.scene,skip:t.skip,tag:t.tag}));function C(n={}){const r={...n};for(const k in r)r[k]===void 0&&delete r[k];N.value=r}P(()=>t,async()=>{const{actName:n,scene:r,skip:k,tag:H,...$}=t;C($)},{deep:!0,immediate:!0});const{isFloat:O,currentActName:b,currentActSceneList:I,currentScene:_,currentSceneOrder:Z,currentActor:Ae,hasPrevScene:G,hasNextScene:L,totalSceneCount:U,action:Ne,cut:Ce,addScene:$e,removeScene:Y,prevScene:K,nextScene:Q,jumpToScene:Te}=Pe(),y=p(()=>b.value===a.value.actName&&_.value===a.value.scene);function qe(n,r){Ne(n||a.value.actName,r)}async function B(){await a.value.onBeforeCut(g),Ce(),await a.value.onAfterCut(g)}const g=se({actName:a.value.actName,scene:a.value.scene,currentActName:b,currentActSceneList:I,currentScene:_,currentSceneOrder:Z,currentActor:Ae,hasPrevScene:G,hasNextScene:L,totalSceneCount:U,isCurrentScene:y,action:qe,cut:B,prevScene:K,nextScene:Q,jumpToScene:Te}),{top:X,bottom:V,left:ee,right:te}=D(o),{width:oe,height:ne}=D(i),{width:ae,height:ie}=He(),Fe=p(()=>{if(e.default===void 0)return"center";if(!a.value.voiceOverAutoPlacement)return a.value.voiceOverPlacement;let n=[];switch(a.value.voiceOverPlacement){case"top":n=["top","bottom","left","right"];break;case"bottom":n=["bottom","top","left","right"];break;case"left":n=["left","top","bottom","right"];break;case"right":n=["right","top","bottom","left"];break}return V.value+ne.value>ie.value&&(n=n.filter(r=>r!=="bottom")),X.value-ne.value<0&&(n=n.filter(r=>r!=="top")),ee.value-oe.value<0&&(n=n.filter(r=>r!=="left")),te.value+oe.value>ae.value&&(n=n.filter(r=>r!=="right")),(X.value<0||V.value>ie.value)&&(n=n.filter(r=>r!=="right"&&r!=="left")),(ee.value<0||te.value>ae.value)&&(n=n.filter(r=>r!=="top"&&r!=="bottom")),n[0]||a.value.voiceOverPlacement});P(()=>({actName:a.value.actName,scene:a.value.scene,skip:a.value.skip}),(n,r)=>{JSON.stringify(n)!==JSON.stringify(r)&&(r!=null&&r.actName&&(r!=null&&r.scene)&&Y(r.actName,r.scene),n!=null&&n.actName&&(n!=null&&n.scene)&&!(n!=null&&n.skip)&&$e(n.actName,n.scene,o))},{deep:!0,immediate:!0}),P(y,async n=>{n?await a.value.onActivated(g):await a.value.onDeactivated(g)}),P(O,async n=>{s(),!n&&y.value&&a.value.cameraFollow&&o.value&&(await Je(o.value,a.value.cameraFollowOptions),a.value.cameraFixAfterFollow&&l())}),Re(()=>{y.value&&B(),Y(a.value.actName,a.value.scene)});const z=f(!1),Ie=f(!1),Le=f(!1),ze=f(!1);return()=>{var n;return u(a.value.tag,{class:"vue-stage-play__scene",style:{position:e.default?y.value?"relative":void 0:"fixed",top:e.default?void 0:"50%",left:e.default?void 0:"50%",zIndex:e.default?y.value?"99998":void 0:"99998",transform:e.default?void 0:"translate(-50%, -50%)"}},[(n=e.default)==null?void 0:n.call(e,g),u("div",{id:`vue-stage-play__spotlight-${a.value.actName}-${a.value.scene}`,class:"vue-stage-play__spotlight",ref:o,style:{position:"absolute",scrollMargin:`${a.value.cameraFollowOffset}px`,top:e.default?`-${a.value.spotlightPadding||0}px`:"-1px",bottom:e.default?`-${a.value.spotlightPadding||0}px`:"-1px",left:e.default?`-${a.value.spotlightPadding||0}px`:"-1px",right:e.default?`-${a.value.spotlightPadding||0}px`:"-1px",pointerEvents:y.value&&!a.value.allowInteract?void 0:"none"}},[u(de,{css:!1,onEnter:c,onLeave:A},()=>{var r,k,H,$,re,le;return[y.value&&!O.value?u("div",{class:"vue-stage-play__voice-over",style:{position:"absolute",zIndex:"99996",color:"#292929",pointerEvents:"auto",...Ze(Fe.value,a.value.voiceOverAlign)},ref:i},[((r=e.voiceOver)==null?void 0:r.call(e,g))||u("div",{class:"default__voice-over",style:{width:`${a.value.voiceOverWidth}px`,margin:"8px",borderRadius:"8px",boxShadow:"0 0 8px rgba(0, 0, 0, 0.2)",backgroundColor:"#fff"}},[u("div",{class:"default__voice-over__header",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:"1px solid #ddd",fontSize:"16px",fontWeight:"bold",lineHeight:"1"}},[((k=e.voHeader)==null?void 0:k.call(e,g))||u("div",{class:"default__voice-over__header__content",style:{flexGrow:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:"1.5"}},a.value.voiceOverTitle),((H=e.voCloseIcon)==null?void 0:H.call(e,g))||u("svg",{class:"default__voice-over__header__close",style:{position:"relative",flexShrink:"0",right:"-4px",display:"block",width:"24px",height:"24px",color:z.value?"#292929":"#7e7e7e",cursor:"pointer",transition:"all 0.2s ease-in-out"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",onMouseenter:()=>{z.value=!0},onMouseleave:()=>{z.value=!1},onClick:()=>B()},[u("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})])]),u("div",{class:"default__voice-over__body",style:{position:"relative",boxSizing:"border-box",minHeight:"60px",padding:"12px",fontSize:"14px",lineHeight:"1.5",textAlign:"center",whiteSpace:"pre-wrap"}},[(($=e.voBody)==null?void 0:$.call(e,g))||a.value.voiceOverContent]),u("div",{class:"default__voice-over__footer",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderTop:"1px solid #ddd"}},[((re=e.voFooter)==null?void 0:re.call(e,g))||u("div",{class:"default__voice-over__footer__scene",style:{fontSize:"14px",color:"#7e7e7e"}},`${Z.value+1} / ${U.value}`),((le=e.voFooterButton)==null?void 0:le.call(e,g))||u("div",{class:"default__voice-over__footer__btns",style:{display:"flex",gap:"8px"}},[G.value&&u("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Ie.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>K()},a.value.voiceOverPrevButtonText),L.value&&u("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Le.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>Q()},a.value.voiceOverNextButtonText),!L.value&&u("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:ze.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>B()},a.value.voiceOverDoneButtonText)])])])]):void 0]})]),y.value&&O.value?u(E,{to:"body"},[u("div",{class:"vue-stage-play__scroll-mask",style:{position:"fixed",top:"0",left:"0",width:"150vw",height:"100vh",zIndex:"99999",overflow:"auto",overscrollBehavior:"none"}},[u("div",{style:{width:"100%",height:"300%"}})])]):void 0,y.value?u(E,{to:"body"},[u("div",{class:"vue-stage-play__click-mask",style:{position:"fixed",top:0,left:0,zIndex:99997,width:"100vw",height:"100vh"},onClick:()=>{a.value.allowLeave&&B()}})]):void 0])}}}),et=ve({name:"StagePlaySpotlight",props:{spotlightPadding:{type:Number,required:!1},spotlightBorderRadius:{type:Number,required:!1},spotlightDarkZoneColor:{type:String,required:!1}},setup(t,{slots:e}){const{isFloat:o,currentActor:i}=Pe(),{enterTransition:l,leaveTransition:s}=Be(600),c=R(fe,{}),A=f({}),w=p(()=>({...ge,...c,...A.value}));function F(_={}){A.value=JSON.parse(JSON.stringify(_))}P(()=>t,()=>{F(t)},{deep:!0,immediate:!0}),De(pe,{spotlightPadding:w.value.spotlightPadding});const{top:N,left:a,width:C,height:O}=D(i);P(i,()=>{o.value=!0});const b=Ee?document.documentElement||document.body:void 0,I=p(()=>({position:"absolute",zIndex:99995,top:!o.value&&i.value?"0px":`${N.value+((b==null?void 0:b.scrollTop)||0)}px`,left:!o.value&&i.value?"0px":`${a.value+((b==null?void 0:b.scrollLeft)||0)}px`,width:C.value?C.value+"px":"100%",height:O.value?O.value+"px":"100%",borderRadius:`${w.value.spotlightBorderRadius}px ${w.value.spotlightBorderRadius}px ${w.value.spotlightBorderRadius}px ${w.value.spotlightBorderRadius-.001}px`,boxShadow:`${w.value.spotlightDarkZoneColor} 0px 0px 0px 3000px`,transition:"all 0.35s ease",pointerEvents:"none"}));return()=>{var _;return[(_=e.default)==null?void 0:_.call(e),u(E,{to:!o.value&&(i==null?void 0:i.value)||"body"},u(de,{css:!1,onEnter:l,onLeave:s},()=>[i!=null&&i.value?u("div",{class:"vue-stage-play__spotlight-bulb",style:I.value,onTransitionend:()=>{o.value=!1}}):null]))]}}});export{Ve as S,et as a,Xe as u};
