import{h as f,a0 as ue,g as d,d as se,M as E,x as P,U as Re,a1 as D,a2 as l,T as ce,a3 as W,a4 as Ee,a5 as De,a6 as We}from"./framework.6467b237.js";const ve="vue-stage-play-global",de="vue-stage-play-spotlight",pe={spotlightPadding:10,spotlightBorderRadius:10,spotlightDarkZoneColor:"rgba(66, 66, 66, 0.5)",allowInteract:!1,allowLeave:!0,cameraFollow:!0,cameraFollowOffset:24,cameraFollowOptions:{behavior:"smooth",block:"start",inline:"nearest"},cameraFixAfterFollow:!0,voiceOverPlacement:"bottom",voiceOverAutoPlacement:!0,voiceOverAlign:"center",voiceOverWidth:300,voiceOverTitle:"Hamlet Act 3 Scene 2",voiceOverContent:"To be, or not to be; that's the question.",voiceOverPrevButtonText:"Back",voiceOverNextButtonText:"Next",voiceOverDoneButtonText:"Done",onBeforeCut:()=>{},onAfterCut:()=>{},onActivated:()=>{},onDeactivated:()=>{}},I=f(!1);function fe(){const e=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${e}px`,document.body.style.width="100%"}function ge(){const e=document.body.style.top;document.body.style.position="",document.body.style.top="",document.body.style.width="auto",window.scrollTo(0,parseInt(e||"0")*-1)}function he(){ge(),fe()}function je(){I.value||(I.value=!0,window.addEventListener("resize",he),fe())}function Je(){I.value&&(I.value=!1,window.removeEventListener("resize",he),ge())}function ye(){return{fixed:je,reset:Je}}const w="[Vue Stage Play]",h={alreadyPlayingAct:e=>`${w} "${e}" is already playing.`,noSceneInAct:e=>`${w} No scene in "${e}"`,noSpecifiedSceneInAct:(e,o)=>`${w} No scene "${o}" in "${e}"`,noPlayingAct:()=>`${w} No playing act.`,noPreviousScene:()=>`${w} No previous scene.`,noNextScene:()=>`${w} No next scene.`,noSpecifiedScene:()=>`${w} No such scene`,sceneNumberShouldBePositive:()=>`${w} Scene number should be positive`,canNotRemoveCurrentScene:()=>`${w} Can't remove current scene`};function Me(e,o,i){const r=e.length;if(r===0)return-1;let s=r-1;for(;s>=0;){if(o.call(i,e[s],s,e))return s;s--}return-1}const{reset:Ze}=ye(),m=ue({}),x=f(),p=d(()=>x.value?m[x.value]?m[x.value]:[]:[]),j=d(()=>p.value?p.value.map((e,o)=>e!==void 0?o:void 0).filter(e=>e!==void 0):[]),L=d(()=>!p.value||!v.value?-1:j.value.findIndex(e=>e===v.value)),v=f(),me=d(()=>{if(!x.value||!p.value.length||v.value===void 0)return;const e=p.value[v.value];return e!==void 0?e.value:void 0}),J=d(()=>p.value?p.value.filter(e=>e!==void 0).length:0),M=d(()=>L.value-1>=0),Z=d(()=>L.value+1<J.value);function xe(e,o){if(x.value){console.warn(h.alreadyPlayingAct(x.value));return}const i=m[e],r=Array.isArray(i)?i:[];if(r.length===0){console.warn(h.noSceneInAct(e));return}if(o!==void 0&&!r[o]){console.warn(h.noSpecifiedSceneInAct(e,o));return}x.value=e,v.value=o!==void 0?o:r.findIndex(s=>s!==void 0)}function be(){x.value=void 0,v.value=void 0,Ze()}function Ge(e,o,i){if(o<0)throw new Error(h.sceneNumberShouldBePositive());m[e]||(m[e]=[]);const r=m[e];Array.isArray(r)&&(r[o]=i)}function Ue(e,o){if(!m[e])return;if(v.value===o){console.warn(h.canNotRemoveCurrentScene());return}const i=m[e];Array.isArray(i)&&(i[o]=void 0)}function Se(){const e=v.value;if(!p.value||e===void 0){console.warn(h.noPlayingAct());return}if(!M.value){console.warn(h.noPreviousScene());return}v.value=Me(p.value,(o,i)=>i<e&&o!==void 0)}function _e(){const e=v.value;if(!p.value||e===void 0){console.warn(h.noPlayingAct());return}if(!Z.value){console.warn(h.noNextScene());return}v.value=p.value.findIndex((o,i)=>i>e&&o!==void 0)}function we(e){if(!p.value||v.value===void 0){console.warn(h.noPlayingAct());return}if(p.value[e]===void 0){console.warn(h.noSpecifiedScene());return}v.value=e}const Ye=f(!0);function Qe(){return{acts:m,currentActName:x,currentActSceneList:j,totalSceneCount:J,currentScene:v,currentSceneOrder:L,currentActor:me,hasPrevScene:M,hasNextScene:Z,action:xe,cut:be,prevScene:Se,nextScene:_e,jumpToScene:we}}function Oe(){return{isFloat:Ye,acts:m,currentActName:x,currentActSceneList:j,currentScene:v,currentSceneOrder:L,currentActor:me,hasPrevScene:M,hasNextScene:Z,totalSceneCount:J,action:xe,cut:be,addScene:Ge,removeScene:Ue,prevScene:Se,nextScene:_e,jumpToScene:we}}function re(){return[{opacity:0},{opacity:1}]}function le(e,o,i,r){const s=e.animate(i,r);s.onfinish=()=>{o()}}function ke(e){function o(r,s){const O=re();le(r,s,O,{duration:e,easing:"ease"})}function i(r,s){const O=re().reverse();le(r,s,O,{duration:e,easing:"ease"})}return{enterTransition:o,leaveTransition:i}}const Xe=se({name:"StagePlaySpotlight",props:{spotlightPadding:{type:Number,required:!1},spotlightBorderRadius:{type:Number,required:!1},spotlightDarkZoneColor:{type:String,required:!1}},setup(e,{slots:o}){const{isFloat:i,currentActor:r}=Oe(),{enterTransition:s,leaveTransition:O}=ke(600),A=E(ve,{}),T=f({}),b=d(()=>({...pe,...A,...T.value}));function a(k={}){T.value=JSON.parse(JSON.stringify(k))}P(()=>e,()=>{a(e)},{deep:!0,immediate:!0}),Re(de,{spotlightPadding:b.value.spotlightPadding});const{top:z,left:B,width:N,height:q}=D(r);P(r,()=>{i.value=!0});const S=Ee?document.documentElement||document.body:void 0,F=d(()=>({position:"absolute",zIndex:99995,top:!i.value&&r.value?"0px":`${z.value+((S==null?void 0:S.scrollTop)||0)}px`,left:!i.value&&r.value?"0px":`${B.value+((S==null?void 0:S.scrollLeft)||0)}px`,width:N.value?N.value+"px":"100%",height:q.value?q.value+"px":"100%",borderRadius:`${b.value.spotlightBorderRadius}px ${b.value.spotlightBorderRadius}px ${b.value.spotlightBorderRadius}px ${b.value.spotlightBorderRadius-.001}px`,boxShadow:`${b.value.spotlightDarkZoneColor} 0px 0px 0px 3000px`,transition:"all 0.35s ease",pointerEvents:"none"}));return()=>{var k;return[(k=o.default)==null?void 0:k.call(o),l(W,{to:!i.value&&(r==null?void 0:r.value)||"body"},l(ce,{css:!1,onEnter:s,onLeave:O},()=>[r!=null&&r.value?l("div",{class:"vue-stage-play__spotlight-bulb",style:F.value,onTransitionend:()=>{i.value=!1}}):null]))]}}}),Ve=se({slots:Object,name:"StagePlayScene",props:{actName:{type:String,required:!0},scene:{type:Number,required:!0,validator:e=>e>=0},tag:{type:String,required:!1,default:"div"},skip:{type:Boolean,required:!1,default:!1},allowInteract:{type:Boolean,required:!1,default:void 0},allowLeave:{type:Boolean,required:!1,default:void 0},cameraFollow:{type:Boolean,required:!1,default:void 0},cameraFollowOffset:{type:Number,required:!1},cameraFollowOptions:{type:Object,required:!1},cameraFixAfterFollow:{type:Boolean,required:!1,default:void 0},voiceOverPlacement:{type:String,required:!1},voiceOverAutoPlacement:{type:Boolean,required:!1,default:void 0},voiceOverAlign:{type:String,required:!1},voiceOverWidth:{type:Number,required:!1},voiceOverTitle:{type:String,required:!1},voiceOverContent:{type:String,required:!1},voiceOverPrevButtonText:{type:String,required:!1},voiceOverNextButtonText:{type:String,required:!1},voiceOverDoneButtonText:{type:String,required:!1},onBeforeCut:{type:Function,required:!1},onAfterCut:{type:Function,required:!1},onActivated:{type:Function,required:!1},onDeactivated:{type:Function,required:!1}},setup(e,{slots:o}){const i=f(null),r=f(null),{enterTransition:s,leaveTransition:O}=ke(250),A=E(ve,{}),T=E(de),b=f({}),a=d(()=>({...pe,...A,...T,...b.value,actName:e.actName,scene:e.scene,skip:e.skip,tag:e.tag}));function z(t={}){b.value=JSON.parse(JSON.stringify(t))}P(()=>e,async()=>{const{actName:t,scene:n,skip:u,tag:g,...c}=e;z(c)},{deep:!0,immediate:!0});const{isFloat:B,currentActName:N,currentActSceneList:q,currentScene:S,currentSceneOrder:F,hasPrevScene:k,hasNextScene:H,totalSceneCount:G,action:Pe,cut:Ae,addScene:Be,removeScene:U,prevScene:Y,nextScene:K,jumpToScene:Ne}=Oe(),_=d(()=>N.value===a.value.actName&&S.value===a.value.scene),y=ue({currentActName:N,currentActSceneList:q,currentScene:S,currentSceneOrder:F,hasPrevScene:k,hasNextScene:H,totalSceneCount:G,isCurrentScene:_,action:Ce,cut:C,prevScene:Y,nextScene:K,jumpToScene:Ne});function Ce(t,n){Pe(t||a.value.actName,n)}function C(){a.value.onBeforeCut(y),Ae(),a.value.onAfterCut(y)}const{top:Q,bottom:X,left:V,right:ee}=D(i),{width:te,height:oe}=D(r),{width:ne,height:ae}=De(),$e=d(()=>{if(!a.value.voiceOverAutoPlacement)return a.value.voiceOverPlacement;let t=[];switch(a.value.voiceOverPlacement){case"top":t=["top","bottom","left","right"];break;case"bottom":t=["bottom","top","left","right"];break;case"left":t=["left","top","bottom","right"];break;case"right":t=["right","top","bottom","left"];break}return X.value+oe.value>ae.value&&(t=t.filter(n=>n!=="bottom")),Q.value-oe.value<0&&(t=t.filter(n=>n!=="top")),V.value-te.value<0&&(t=t.filter(n=>n!=="left")),ee.value+te.value>ne.value&&(t=t.filter(n=>n!=="right")),(Q.value<0||X.value>ae.value)&&(t=t.filter(n=>n!=="right"&&n!=="left")),(V.value<0||ee.value>ne.value)&&(t=t.filter(n=>n!=="top"&&n!=="bottom")),t[0]||a.value.voiceOverPlacement}),{fixed:Te,reset:qe}=ye();function Fe(t){return new Promise(n=>{let u=0,g;t.scrollIntoView(a.value.cameraFollowOptions),requestAnimationFrame(c);function c(){const $=t.getBoundingClientRect().top;if($===g){if(u++>2)return n()}else u=0,g=$;requestAnimationFrame(c)}})}P(()=>({actName:a.value.actName,scene:a.value.scene,skip:a.value.skip}),(t,n)=>{JSON.stringify(t)!==JSON.stringify(n)&&(n!=null&&n.actName&&(n!=null&&n.scene)&&U(n.actName,n.scene),t!=null&&t.actName&&(t!=null&&t.scene)&&!(t!=null&&t.skip)&&Be(t.actName,t.scene,i))},{deep:!0,immediate:!0}),P(_,t=>{t||a.value.onDeactivated(y)}),P(B,async t=>{qe(),!t&&_.value&&a.value.cameraFollow&&i.value&&(await Fe(i.value),a.value.cameraFixAfterFollow&&Te())}),We(()=>{_.value&&C(),U(a.value.actName,a.value.scene)});const Ie=d(()=>{let t="",n="",u="",g="",c="";switch($e.value){case"top":switch(t="0",u="0",c="translate(0, -100%)",a.value.voiceOverAlign){case"start":u="0";break;case"center":u="50%",c="translate(-50%, -100%)";break;case"end":u="unset",g="0";break}break;case"bottom":switch(n="0",u="0",c="translate(0, 100%)",a.value.voiceOverAlign){case"start":u="0";break;case"center":u="50%",c="translate(-50%, 100%)";break;case"end":u="unset",g="0";break}break;case"left":switch(t="0",u="0",c="translate(-100%, 0)",a.value.voiceOverAlign){case"start":t="0";break;case"center":t="50%",c="translate(-100%, -50%)";break;case"end":t="unset",n="0";break}break;case"right":switch(t="0",g="0",c="translate(100%, 0)",a.value.voiceOverAlign){case"start":t="0";break;case"center":t="50%",c="translate(100%, -50%)";break;case"end":t="unset",n="0";break}break}return{position:"absolute",zIndex:"99996",color:"#292929",pointerEvents:"auto",top:t,bottom:n,left:u,right:g,transform:c}}),R=f(!1),Le=f(!1),ze=f(!1),He=f(!1);return()=>{var t;return l(a.value.tag,{class:"vue-stage-play__scene",style:{position:"relative",zIndex:_.value?"99998":""}},[(t=o.default)==null?void 0:t.call(o,y).map(n=>{var u;return n.props={...n.props,style:{...(u=n.props)==null?void 0:u.style,pointerEvents:_.value&&!a.value.allowInteract?"none":"auto"}},n}),l("div",{id:`vue-stage-play__spotlight-${a.value.actName}-${a.value.scene}`,class:"vue-stage-play__spotlight",ref:i,style:{position:"absolute",scrollMargin:`${a.value.cameraFollowOffset}px`,top:`-${a.value.spotlightPadding||0}px`,bottom:`-${a.value.spotlightPadding||0}px`,left:`-${a.value.spotlightPadding||0}px`,right:`-${a.value.spotlightPadding||0}px`,pointerEvents:"none"}},[l(ce,{css:!1,onEnter:s,onLeave:O},()=>{var n,u,g,c,$,ie;return[_.value&&!B.value?l("div",{class:"vue-stage-play__voice-over",style:Ie.value,ref:r},[((n=o.voiceOver)==null?void 0:n.call(o,y))||l("div",{class:"default__voice-over",style:{width:`${a.value.voiceOverWidth}px`,margin:"8px",borderRadius:"8px",boxShadow:"0 0 8px rgba(0, 0, 0, 0.2)",backgroundColor:"#fff"}},[l("div",{class:"default__voice-over__header",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:"1px solid #ddd",fontSize:"16px",fontWeight:"bold",lineHeight:"1"}},[((u=o.voHeader)==null?void 0:u.call(o,y))||l("div",{class:"default__voice-over__header__content",style:{flexGrow:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},a.value.voiceOverTitle),((g=o.voCloseIcon)==null?void 0:g.call(o,y))||l("svg",{class:"default__voice-over__header__close",style:{position:"relative",flexShrink:"0",right:"-4px",display:"block",width:"24px",height:"24px",color:R.value?"#292929":"#7e7e7e",cursor:"pointer",transition:"all 0.2s ease-in-out"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",onMouseenter:()=>{R.value=!0},onMouseleave:()=>{R.value=!1},onClick:()=>C()},[l("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})])]),l("div",{class:"default__voice-over__body",style:{position:"relative",boxSizing:"border-box",minHeight:"60px",padding:"12px",fontSize:"14px",lineHeight:"1.5",textAlign:"center",whiteSpace:"pre-wrap"}},[((c=o.voBody)==null?void 0:c.call(o,y))||a.value.voiceOverContent]),l("div",{class:"default__voice-over__footer",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderTop:"1px solid #ddd"}},[(($=o.voFooter)==null?void 0:$.call(o,y))||l("div",{class:"default__voice-over__footer__scene",style:{fontSize:"14px",color:"#7e7e7e"}},`${F.value+1} / ${G.value}`),((ie=o.voFooterButton)==null?void 0:ie.call(o,y))||l("div",{class:"default__voice-over__footer__btns",style:{display:"flex",gap:"8px"}},[k.value&&l("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Le.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>Y()},a.value.voiceOverPrevButtonText),H.value&&l("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:ze.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>K()},a.value.voiceOverNextButtonText),!H.value&&l("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:He.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>C()},a.value.voiceOverDoneButtonText)])])])]):void 0]})]),_.value&&B.value?l(W,{to:"body"},[l("div",{class:"vue-stage-play__scroll-mask",style:{position:"fixed",top:"0",left:"0",width:"150vw",height:"100vh",zIndex:"99999",overflow:"auto",overscrollBehavior:"none"}},[l("div",{style:{width:"100%",height:"300%"}})])]):void 0,_.value?l(W,{to:"body"},[l("div",{class:"vue-stage-play__click-mask",style:{position:"fixed",top:0,left:0,zIndex:99997,width:"100vw",height:"100vh"},onClick:()=>{a.value.allowLeave&&C()}})]):void 0])}}});export{Ve as S,Xe as a,Qe as u};
