import{h as d,a0 as se,g,d as ce,M as Z,x as A,U as Fe,a1 as G,a2 as r,T as Te,a3 as U,a4 as Ie,O as $e,a5 as ze,a6 as Le}from"./framework.6467b237.js";const ve="vue-stage-play-global",de="vue-stage-play-spotlight",fe={spotlightPadding:10,spotlightBorderRadius:10,spotlightDarkZoneColor:"rgba(66, 66, 66, 0.5)",allowInteract:!1,allowLeave:!0,cameraFollow:!0,cameraFollowOffset:24,cameraFollowOptions:{behavior:"smooth",block:"start",inline:"nearest"},cameraFixAfterFollow:!0,voiceOverPlacement:"bottom",voiceOverAutoPlacement:!0,voiceOverAlign:"center",voiceOverWidth:300,voiceOverTitle:"Hamlet Act 3 Scene 2",voiceOverContent:"To be, or not to be; that's the question.",voiceOverPrevButtonText:"Back",voiceOverNextButtonText:"Next",voiceOverDoneButtonText:"Done",onBeforeCut:()=>{},onAfterCut:()=>{},onActivated:()=>{},onDeactivated:()=>{}},D=d(!1);function pe(){const t=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${t}px`,document.body.style.width="100%"}function ge(){const t=document.body.style.top;document.body.style.position="",document.body.style.top="",document.body.style.width="auto",window.scrollTo(0,parseInt(t||"0")*-1)}function he(){ge(),pe()}function He(){D.value||(D.value=!0,window.addEventListener("resize",he),pe())}function Re(){D.value&&(D.value=!1,window.removeEventListener("resize",he),ge())}function ye(){return{fixed:He,reset:Re}}const{reset:De}=ye(),m=se({}),x=d(),h=g(()=>x.value?m[x.value]?m[x.value]:[]:[]),Y=g(()=>h.value?h.value.map((t,o)=>t!==void 0?o:void 0).filter(t=>t!==void 0):[]),E=g(()=>!h.value||!f.value?0:Y.value.findIndex(t=>t===f.value)),f=d(),me=g(()=>{if(!x.value||!h.value.length||f.value===void 0)return;const t=h.value[f.value];return t!==void 0?t.value:void 0}),K=g(()=>h.value?h.value.filter(t=>t!==void 0).length:0),Q=g(()=>E.value-1>=0),X=g(()=>E.value+1<K.value);function xe(t,o){if(x.value){console.warn(`[Vue Stage Play] Act ${x.value} already in action`);return}const i=m[t],c=Array.isArray(i)?i:[];if(c.length===0){console.warn(`[Vue Stage Play] No scene in act ${t}`);return}if(o!==void 0&&!c[o]){console.warn(`[Vue Stage Play] No scene ${o} in act ${t}`);return}x.value=t,f.value=o!==void 0?o:c.findIndex(B=>B!==void 0)}function be(){x.value=void 0,f.value=void 0,De()}function Ee(t,o,i){m[t]||(m[t]=[]);const c=m[t];Array.isArray(c)&&(c[o]=i)}function We(t,o){if(!m[t])return;if(f.value===o){console.warn("[Vue Stage Play] Can't remove current scene");return}const i=m[t];Array.isArray(i)&&(i[o]=void 0)}function Se(){const t=f.value;if(!h.value||t===void 0){console.warn("[Vue Stage Play] No playing act.");return}if(!Q.value){console.warn("[Vue Stage Play] No previous scene.");return}f.value=h.value.findLastIndex((o,i)=>i<t&&o!==void 0)}function _e(){const t=f.value;if(!h.value||t===void 0){console.warn("[Vue Stage Play] No playing act.");return}if(!X.value){console.warn("[Vue Stage Play] No next scene.");return}f.value=h.value.findIndex((o,i)=>i>t&&o!==void 0)}function we(t){if(!h.value||f.value===void 0){console.warn("[Vue Stage Play] No playing act.");return}if(h.value[t]===void 0){console.warn("[Vue Stage Play] No such scene");return}f.value=t}function je(){return{acts:m,currentActName:x,currentActSceneList:Y,totalSceneCount:K,currentScene:f,currentSceneOrder:E,currentActor:me,hasPrevScene:Q,hasNextScene:X,action:xe,cut:be,prevScene:Se,nextScene:_e,jumpToScene:we}}function Je(){return{acts:m,currentActName:x,currentActSceneList:Y,currentScene:f,currentSceneOrder:E,currentActor:me,hasPrevScene:Q,hasNextScene:X,totalSceneCount:K,action:xe,cut:be,addScene:Ee,removeScene:We,prevScene:Se,nextScene:_e,jumpToScene:we}}const Ze=ce({name:"StagePlaySpotlight",props:{spotlightPadding:{type:Number,required:!1},spotlightBorderRadius:{type:Number,required:!1},spotlightDarkZoneColor:{type:String,required:!1}},setup(t,{slots:o}){const{currentActName:i,currentActor:c}=je(),B=Z(ve,{}),F=d({}),_=g(()=>({...fe,...B,...F.value}));function a(l={}){F.value=JSON.parse(JSON.stringify(l))}A(()=>t,()=>{a(t)},{deep:!0,immediate:!0}),Fe(de,{spotlightPadding:_.value.spotlightPadding,spotlightBorderRadius:_.value.spotlightBorderRadius});const b=Ie?document.documentElement||document.body:void 0,S=d(!0),P=d(!1);A(i,()=>{i.value&&(P.value=!0)});const O=d(null),{top:T,left:I,width:k,height:N}=G(O);A(c,l=>{S.value=!0,l?O.value=l:!l&&i.value===void 0&&$e(()=>{O.value=null,P.value=!1})});function $(){return[{opacity:0},{opacity:1}]}function z(l,w,p,v){const j=l.animate(p,v);j.onfinish=()=>{w()}}function W(l,w){const p=$();z(l,w,p,{duration:600,easing:"ease"})}function L(l,w){const p=$().reverse();z(l,w,p,{duration:600,easing:"ease"})}const H=g(()=>({position:"absolute",top:!S.value&&c.value?"0":`${T.value+((b==null?void 0:b.scrollTop)||0)}px`,left:!S.value&&c.value?"0":`${I.value+((b==null?void 0:b.scrollLeft)||0)}px`,zIndex:99995,width:k.value?k.value+"px":"100%",height:N.value?N.value+"px":"100%",borderRadius:`${_.value.spotlightBorderRadius}px`,boxShadow:`${_.value.spotlightDarkZoneColor} 0px 0px 0px 5000px`,transition:"all 0.6s ease",pointerEvents:"none"}));return()=>{var l;return[(l=o.default)==null?void 0:l.call(o),r(U,{to:!S.value&&c.value?c.value:"body"},r(Te,{css:!1,onEnter:W,onLeave:L},()=>[P.value?r("div",{class:"vue-stage-play__spotlight-bulb",style:H.value,onTransitionend:()=>{S.value=!1}}):null]))]}}}),Ge=ce({slots:Object,name:"StagePlayScene",props:{actName:{type:String,required:!0},scene:{type:Number,required:!0,validator:t=>t>=0},tag:{type:String,required:!1,default:"div"},skip:{type:Boolean,required:!1,default:!1},allowInteract:{type:Boolean,required:!1,default:void 0},allowLeave:{type:Boolean,required:!1,default:void 0},cameraFollow:{type:Boolean,required:!1,default:void 0},cameraFollowOffset:{type:Number,required:!1},cameraFollowOptions:{type:Object,required:!1},cameraFixAfterFollow:{type:Boolean,required:!1,default:void 0},voiceOverPlacement:{type:String,required:!1},voiceOverAutoPlacement:{type:Boolean,required:!1,default:void 0},voiceOverAlign:{type:String,required:!1},voiceOverWidth:{type:Number,required:!1},voiceOverTitle:{type:String,required:!1},voiceOverContent:{type:String,required:!1},voiceOverPrevButtonText:{type:String,required:!1},voiceOverNextButtonText:{type:String,required:!1},voiceOverDoneButtonText:{type:String,required:!1},onBeforeCut:{type:Function,required:!1},onAfterCut:{type:Function,required:!1},onActivated:{type:Function,required:!1},onDeactivated:{type:Function,required:!1}},setup(t,{slots:o}){const i=d(null),c=d(null),B=Z(ve,{}),F=Z(de),_=d({}),a=g(()=>({...fe,...B,...F,..._.value,actName:t.actName,scene:t.scene,skip:t.skip,tag:t.tag}));function b(e={}){_.value=JSON.parse(JSON.stringify(e))}A(()=>t,async()=>{const{actName:e,scene:n,skip:u,tag:y,...s}=t;b(s)},{deep:!0,immediate:!0});const{currentActName:S,currentActSceneList:P,currentScene:O,currentSceneOrder:T,hasPrevScene:I,hasNextScene:k,totalSceneCount:N,action:$,cut:z,addScene:W,removeScene:L,prevScene:H,nextScene:l,jumpToScene:w}=Je(),p=g(()=>S.value===a.value.actName&&O.value===a.value.scene),v=se({currentActName:S,currentActSceneList:P,currentScene:O,currentSceneOrder:T,hasPrevScene:I,hasNextScene:k,totalSceneCount:N,isCurrentScene:p,action:j,cut:C,prevScene:H,nextScene:l,jumpToScene:w});function j(e,n){$(e||a.value.actName,n)}function C(){a.value.onBeforeCut(v),z(),a.value.onAfterCut(v)}const{top:V,bottom:ee,left:te,right:oe}=G(i),{width:ae,height:ne}=G(c),{width:re,height:ie}=ze(),Oe=g(()=>{if(!a.value.voiceOverAutoPlacement)return a.value.voiceOverPlacement;let e=[];switch(a.value.voiceOverPlacement){case"top":e=["top","bottom","left","right"];break;case"bottom":e=["bottom","top","left","right"];break;case"left":e=["left","top","bottom","right"];break;case"right":e=["right","top","bottom","left"];break}return ee.value+ne.value>ie.value&&(e=e.filter(n=>n!=="bottom")),V.value-ne.value<0&&(e=e.filter(n=>n!=="top")),te.value-ae.value<0&&(e=e.filter(n=>n!=="left")),oe.value+ae.value>re.value&&(e=e.filter(n=>n!=="right")),(V.value<0||ee.value>ie.value)&&(e=e.filter(n=>n!=="right"&&n!=="left")),(te.value<0||oe.value>re.value)&&(e=e.filter(n=>n!=="top"&&n!=="bottom")),e[0]||a.value.voiceOverPlacement}),{fixed:ke,reset:Ae}=ye();function Be(e){return new Promise(n=>{let u=0,y;e.scrollIntoView(a.value.cameraFollowOptions),requestAnimationFrame(s);function s(){const q=e.getBoundingClientRect().top;if(q===y){if(u++>2)return n()}else u=0,y=q;requestAnimationFrame(s)}})}A(()=>({actName:a.value.actName,scene:a.value.scene,skip:a.value.skip}),(e,n)=>{JSON.stringify(e)!==JSON.stringify(n)&&(n!=null&&n.actName&&(n!=null&&n.scene)&&L(n.actName,n.scene),e!=null&&e.actName&&(e!=null&&e.scene)&&!(e!=null&&e.skip)&&W(e.actName,e.scene,i))},{deep:!0,immediate:!0});const J=d(!1);A(i,async e=>{if(Ae(),!e){a.value.onDeactivated(v);return}a.value.cameraFollow&&(J.value=!0,await Be(e),J.value=!1,a.value.cameraFixAfterFollow&&ke()),a.value.onActivated(v)}),Le(()=>{p.value&&C(),L(a.value.actName,a.value.scene)});const Pe=g(()=>{let e="",n="",u="",y="",s="";switch(Oe.value){case"top":switch(e="0",u="0",s="translate(0, -100%)",a.value.voiceOverAlign){case"start":u="0";break;case"center":u="50%",s="translate(-50%, -100%)";break;case"end":u="unset",y="0";break}break;case"bottom":switch(n="0",u="0",s="translate(0, 100%)",a.value.voiceOverAlign){case"start":u="0";break;case"center":u="50%",s="translate(-50%, 100%)";break;case"end":u="unset",y="0";break}break;case"left":switch(e="0",u="0",s="translate(-100%, 0)",a.value.voiceOverAlign){case"start":e="0";break;case"center":e="50%",s="translate(-100%, -50%)";break;case"end":e="unset",n="0";break}break;case"right":switch(e="0",y="0",s="translate(100%, 0)",a.value.voiceOverAlign){case"start":e="0";break;case"center":e="50%",s="translate(100%, -50%)";break;case"end":e="unset",n="0";break}break}return{position:"absolute",zIndex:"99996",color:"#292929",pointerEvents:"auto",top:e,bottom:n,left:u,right:y,transform:s}}),M=d(!1),Ne=d(!1),Ce=d(!1),qe=d(!1);return()=>{var e,n,u,y,s,q,le;return r(a.value.tag,{class:"vue-stage-play__scene",style:{position:"relative",zIndex:p.value?"99998":""}},[(e=o.default)==null?void 0:e.call(o,v).map(R=>{var ue;return R.props={...R.props,style:{...(ue=R.props)==null?void 0:ue.style,pointerEvents:p.value&&!a.value.allowInteract?"none":"auto"}},R}),p.value?r("div",{id:`vue-stage-play__spotlight-${a.value.actName}-${a.value.scene}`,class:"vue-stage-play__spotlight",ref:i,style:{position:"absolute",scrollMargin:`${a.value.cameraFollowOffset}px`,inset:`-${a.value.spotlightPadding||0}px`,borderRadius:`${a.value.spotlightBorderRadius||0}px`,overflow:"none",pointerEvents:"none"}},[r("div",{class:"vue-stage-play__voice-over",style:Pe.value,ref:c},[((n=o.voiceOver)==null?void 0:n.call(o,v))||r("div",{class:"default__voice-over",style:{width:`${a.value.voiceOverWidth}px`,margin:"8px",borderRadius:"8px",boxShadow:"0 0 8px rgba(0, 0, 0, 0.2)",backgroundColor:"#fff"}},[r("div",{class:"default__voice-over__header",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:"1px solid #ddd",fontSize:"16px",fontWeight:"bold",lineHeight:"1"}},[((u=o.voHeader)==null?void 0:u.call(o,v))||r("div",{class:"efault__voice-over__header__content",style:{flexGrow:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},a.value.voiceOverTitle),((y=o.voCloseIcon)==null?void 0:y.call(o,v))||r("svg",{class:"default__voice-over__header__close",style:{position:"relative",flexShrink:"0",right:"-4px",display:"block",width:"24px",height:"24px",color:M.value?"#292929":"#7e7e7e",cursor:"pointer",transition:"all 0.2s ease-in-out"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",onMouseenter:()=>{M.value=!0},onMouseleave:()=>{M.value=!1},onClick:()=>C()},[r("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})])]),r("div",{class:"default__voice-over__body",style:{position:"relative",boxSizing:"border-box",minHeight:"60px",padding:"12px",fontSize:"14px",lineHeight:"1.5",textAlign:"center",whiteSpace:"pre-wrap"}},[((s=o.voBody)==null?void 0:s.call(o,v))||a.value.voiceOverContent]),r("div",{class:"default__voice-over__footer",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderTop:"1px solid #ddd"}},[((q=o.voFooter)==null?void 0:q.call(o,v))||r("div",{class:"default__voice-over__footer__scene",style:{fontSize:"14px",color:"#7e7e7e"}},`${T.value+1} / ${N.value}`),((le=o.voFooterButton)==null?void 0:le.call(o,v))||r("div",{class:"default__voice-over__footer__btns",style:{display:"flex",gap:"8px"}},[I.value&&r("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Ne.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>H()},a.value.voiceOverPrevButtonText),k.value&&r("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Ce.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>l()},a.value.voiceOverNextButtonText),!k.value&&r("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:qe.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>C()},a.value.voiceOverDoneButtonText)])])])])]):void 0,p.value&&J.value?r(U,{to:"body"},[r("div",{class:"vue-stage-play__scene__scroll-mask",style:{position:"fixed",top:"0",left:"0",width:"150vw",height:"100vh",zIndex:"99999",overflow:"auto",overscrollBehavior:"none"}},[r("div",{style:{width:"100%",height:"300%"}})])]):void 0,p.value?r(U,{to:"body"},[r("div",{style:{position:"fixed",top:0,left:0,zIndex:99997,width:"100vw",height:"100vh"},onClick:()=>{a.value.allowLeave&&C()}})]):void 0])}}});export{Ge as S,Ze as a,je as u};
