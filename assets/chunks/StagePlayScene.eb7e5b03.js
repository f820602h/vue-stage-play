import{h as d,a0 as le,g as f,d as ue,M as R,x as O,U as He,a1 as D,a2 as i,T as se,a3 as E,O as ne,a4 as Re,a5 as De,a6 as Ee}from"./framework.6467b237.js";const ce="vue-stage-play-global",ve="vue-stage-play-spotlight",de={spotlightPadding:10,spotlightBorderRadius:10,spotlightDarkZoneColor:"rgba(66, 66, 66, 0.5)",allowInteract:!1,allowLeave:!0,cameraFollow:!0,cameraFollowOffset:24,cameraFollowOptions:{behavior:"smooth",block:"start",inline:"nearest"},cameraFixAfterFollow:!0,voiceOverPlacement:"bottom",voiceOverAutoPlacement:!0,voiceOverAlign:"center",voiceOverWidth:300,voiceOverTitle:"Hamlet Act 3 Scene 2",voiceOverContent:"To be, or not to be; that's the question.",voiceOverPrevButtonText:"Back",voiceOverNextButtonText:"Next",voiceOverDoneButtonText:"Done",onBeforeCut:()=>{},onAfterCut:()=>{},onActivated:()=>{},onDeactivated:()=>{}},F=d(!1);function fe(){const t=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${t}px`,document.body.style.width="100%"}function pe(){const t=document.body.style.top;document.body.style.position="",document.body.style.top="",document.body.style.width="auto",window.scrollTo(0,parseInt(t||"0")*-1)}function ge(){pe(),fe()}function We(){F.value||(F.value=!0,window.addEventListener("resize",ge),fe())}function je(){F.value&&(F.value=!1,window.removeEventListener("resize",ge),pe())}function he(){return{fixed:We,reset:je}}const{reset:Je}=he(),m=le({}),x=d(),p=f(()=>x.value?m[x.value]?m[x.value]:[]:[]),W=f(()=>p.value?p.value.map((t,o)=>t!==void 0?o:void 0).filter(t=>t!==void 0):[]),I=f(()=>!p.value||!c.value?0:W.value.findIndex(t=>t===c.value)),c=d(),ye=f(()=>{if(!x.value||!p.value.length||c.value===void 0)return;const t=p.value[c.value];return t!==void 0?t.value:void 0}),j=f(()=>p.value?p.value.filter(t=>t!==void 0).length:0),J=f(()=>I.value-1>=0),M=f(()=>I.value+1<j.value);function me(t,o){if(x.value){console.warn(`[Vue Stage Play] Act ${x.value} already in action`);return}const r=m[t],u=Array.isArray(r)?r:[];if(u.length===0){console.warn(`[Vue Stage Play] No scene in act ${t}`);return}if(o!==void 0&&!u[o]){console.warn(`[Vue Stage Play] No scene ${o} in act ${t}`);return}x.value=t,c.value=o!==void 0?o:u.findIndex(v=>v!==void 0)}function xe(){x.value=void 0,c.value=void 0,Je()}function Me(t,o,r){m[t]||(m[t]=[]);const u=m[t];Array.isArray(u)&&(u[o]=r)}function Ze(t,o){if(!m[t])return;if(c.value===o){console.warn("[Vue Stage Play] Can't remove current scene");return}const r=m[t];Array.isArray(r)&&(r[o]=void 0)}function be(){const t=c.value;if(!p.value||t===void 0){console.warn("[Vue Stage Play] No playing act.");return}if(!J.value){console.warn("[Vue Stage Play] No previous scene.");return}c.value=p.value.findLastIndex((o,r)=>r<t&&o!==void 0)}function Se(){const t=c.value;if(!p.value||t===void 0){console.warn("[Vue Stage Play] No playing act.");return}if(!M.value){console.warn("[Vue Stage Play] No next scene.");return}c.value=p.value.findIndex((o,r)=>r>t&&o!==void 0)}function _e(t){if(!p.value||c.value===void 0){console.warn("[Vue Stage Play] No playing act.");return}if(p.value[t]===void 0){console.warn("[Vue Stage Play] No such scene");return}c.value=t}const Ge=d(!0);function Ye(){return{acts:m,currentActName:x,currentActSceneList:W,totalSceneCount:j,currentScene:c,currentSceneOrder:I,currentActor:ye,hasPrevScene:J,hasNextScene:M,action:me,cut:xe,prevScene:be,nextScene:Se,jumpToScene:_e}}function we(){return{isFloat:Ge,acts:m,currentActName:x,currentActSceneList:W,currentScene:c,currentSceneOrder:I,currentActor:ye,hasPrevScene:J,hasNextScene:M,totalSceneCount:j,action:me,cut:xe,addScene:Me,removeScene:Ze,prevScene:be,nextScene:Se,jumpToScene:_e}}function re(){return[{opacity:0},{opacity:1}]}function ie(t,o,r,u){const v=t.animate(r,u);v.onfinish=()=>{o()}}function Oe(t){function o(u,v){const w=re();ie(u,v,w,{duration:t,easing:"ease"})}function r(u,v){const w=re().reverse();ie(u,v,w,{duration:t,easing:"ease"})}return{enterTransition:o,leaveTransition:r}}const Ke=ue({name:"StagePlaySpotlight",props:{spotlightPadding:{type:Number,required:!1},spotlightBorderRadius:{type:Number,required:!1},spotlightDarkZoneColor:{type:String,required:!1}},setup(t,{slots:o}){const{isFloat:r,currentActName:u,currentActor:v}=we(),{enterTransition:w,leaveTransition:k}=Oe(600),L=R(ce,{}),B=d({}),a=f(()=>({...de,...L,...B.value}));function $(g={}){B.value=JSON.parse(JSON.stringify(g))}O(()=>t,()=>{$(t)},{deep:!0,immediate:!0}),He(ve,{spotlightPadding:a.value.spotlightPadding,spotlightBorderRadius:a.value.spotlightBorderRadius});const S=d(null),{top:q,left:z,width:P,height:A}=D(S);O(v,g=>{r.value=!0,g?ne(()=>{S.value=g}):!g&&u.value===void 0&&ne(()=>{S.value=null})});const b=Re?document.documentElement||document.body:void 0,N=f(()=>({position:"absolute",zIndex:99995,top:!r.value&&v.value?"0":`${q.value+((b==null?void 0:b.scrollTop)||0)}px`,left:!r.value&&v.value?"0":`${z.value+((b==null?void 0:b.scrollLeft)||0)}px`,width:P.value?P.value+"px":"100%",height:A.value?A.value+"px":"100%",borderRadius:`${a.value.spotlightBorderRadius}px`,boxShadow:`${a.value.spotlightDarkZoneColor} 0px 0px 0px 5000px`,transition:"all 0.35s ease",pointerEvents:"none"}));return()=>{var g;return[(g=o.default)==null?void 0:g.call(o),i(E,{to:!r.value&&v.value||"body"},i(se,{css:!1,onEnter:w,onLeave:k},()=>[S.value?i("div",{class:"vue-stage-play__spotlight-bulb",style:N.value,onTransitionend:()=>{r.value=!1}}):null]))]}}}),Qe=ue({slots:Object,name:"StagePlayScene",props:{actName:{type:String,required:!0},scene:{type:Number,required:!0,validator:t=>t>=0},tag:{type:String,required:!1,default:"div"},skip:{type:Boolean,required:!1,default:!1},allowInteract:{type:Boolean,required:!1,default:void 0},allowLeave:{type:Boolean,required:!1,default:void 0},cameraFollow:{type:Boolean,required:!1,default:void 0},cameraFollowOffset:{type:Number,required:!1},cameraFollowOptions:{type:Object,required:!1},cameraFixAfterFollow:{type:Boolean,required:!1,default:void 0},voiceOverPlacement:{type:String,required:!1},voiceOverAutoPlacement:{type:Boolean,required:!1,default:void 0},voiceOverAlign:{type:String,required:!1},voiceOverWidth:{type:Number,required:!1},voiceOverTitle:{type:String,required:!1},voiceOverContent:{type:String,required:!1},voiceOverPrevButtonText:{type:String,required:!1},voiceOverNextButtonText:{type:String,required:!1},voiceOverDoneButtonText:{type:String,required:!1},onBeforeCut:{type:Function,required:!1},onAfterCut:{type:Function,required:!1},onActivated:{type:Function,required:!1},onDeactivated:{type:Function,required:!1}},setup(t,{slots:o}){const r=d(null),u=d(null),{enterTransition:v,leaveTransition:w}=Oe(250),k=R(ce,{}),L=R(ve),B=d({}),a=f(()=>({...de,...k,...L,...B.value,actName:t.actName,scene:t.scene,skip:t.skip,tag:t.tag}));function $(e={}){B.value=JSON.parse(JSON.stringify(e))}O(()=>t,async()=>{const{actName:e,scene:n,skip:l,tag:h,...s}=t;$(s)},{deep:!0,immediate:!0});const{isFloat:S,currentActName:q,currentActSceneList:z,currentScene:P,currentSceneOrder:A,hasPrevScene:b,hasNextScene:N,totalSceneCount:g,action:ke,cut:Be,addScene:Pe,removeScene:Z,prevScene:G,nextScene:U,jumpToScene:Ae}=we(),_=f(()=>q.value===a.value.actName&&P.value===a.value.scene),y=le({currentActName:q,currentActSceneList:z,currentScene:P,currentSceneOrder:A,hasPrevScene:b,hasNextScene:N,totalSceneCount:g,isCurrentScene:_,action:Ne,cut:C,prevScene:G,nextScene:U,jumpToScene:Ae});function Ne(e,n){ke(e||a.value.actName,n)}function C(){a.value.onBeforeCut(y),Be(),a.value.onAfterCut(y)}const{top:Y,bottom:K,left:Q,right:X}=D(r),{width:V,height:ee}=D(u),{width:te,height:oe}=De(),Ce=f(()=>{if(!a.value.voiceOverAutoPlacement)return a.value.voiceOverPlacement;let e=[];switch(a.value.voiceOverPlacement){case"top":e=["top","bottom","left","right"];break;case"bottom":e=["bottom","top","left","right"];break;case"left":e=["left","top","bottom","right"];break;case"right":e=["right","top","bottom","left"];break}return K.value+ee.value>oe.value&&(e=e.filter(n=>n!=="bottom")),Y.value-ee.value<0&&(e=e.filter(n=>n!=="top")),Q.value-V.value<0&&(e=e.filter(n=>n!=="left")),X.value+V.value>te.value&&(e=e.filter(n=>n!=="right")),(Y.value<0||K.value>oe.value)&&(e=e.filter(n=>n!=="right"&&n!=="left")),(Q.value<0||X.value>te.value)&&(e=e.filter(n=>n!=="top"&&n!=="bottom")),e[0]||a.value.voiceOverPlacement}),{fixed:Te,reset:qe}=he();function Fe(e){return new Promise(n=>{let l=0,h;e.scrollIntoView(a.value.cameraFollowOptions),requestAnimationFrame(s);function s(){const T=e.getBoundingClientRect().top;if(T===h){if(l++>2)return n()}else l=0,h=T;requestAnimationFrame(s)}})}O(()=>({actName:a.value.actName,scene:a.value.scene,skip:a.value.skip}),(e,n)=>{JSON.stringify(e)!==JSON.stringify(n)&&(n!=null&&n.actName&&(n!=null&&n.scene)&&Z(n.actName,n.scene),e!=null&&e.actName&&(e!=null&&e.scene)&&!(e!=null&&e.skip)&&Pe(e.actName,e.scene,r))},{deep:!0,immediate:!0}),O(r,e=>{qe(),e||a.value.onDeactivated(y)}),O(S,async e=>{e||_.value&&a.value.cameraFollow&&(await Fe(r.value),a.value.cameraFixAfterFollow&&Te())}),Ee(()=>{_.value&&C(),Z(a.value.actName,a.value.scene)});const Ie=f(()=>{let e="",n="",l="",h="",s="";switch(Ce.value){case"top":switch(e="0",l="0",s="translate(0, -100%)",a.value.voiceOverAlign){case"start":l="0";break;case"center":l="50%",s="translate(-50%, -100%)";break;case"end":l="unset",h="0";break}break;case"bottom":switch(n="0",l="0",s="translate(0, 100%)",a.value.voiceOverAlign){case"start":l="0";break;case"center":l="50%",s="translate(-50%, 100%)";break;case"end":l="unset",h="0";break}break;case"left":switch(e="0",l="0",s="translate(-100%, 0)",a.value.voiceOverAlign){case"start":e="0";break;case"center":e="50%",s="translate(-100%, -50%)";break;case"end":e="unset",n="0";break}break;case"right":switch(e="0",h="0",s="translate(100%, 0)",a.value.voiceOverAlign){case"start":e="0";break;case"center":e="50%",s="translate(100%, -50%)";break;case"end":e="unset",n="0";break}break}return{position:"absolute",zIndex:"99996",color:"#292929",pointerEvents:"auto",top:e,bottom:n,left:l,right:h,transform:s}}),H=d(!1),Le=d(!1),$e=d(!1),ze=d(!1);return()=>{var e;return i(a.value.tag,{class:"vue-stage-play__scene",style:{position:"relative",zIndex:_.value?"99998":""}},[(e=o.default)==null?void 0:e.call(o,y).map(n=>{var l;return n.props={...n.props,style:{...(l=n.props)==null?void 0:l.style,pointerEvents:_.value&&!a.value.allowInteract?"none":"auto"}},n}),_.value?i("div",{id:`vue-stage-play__spotlight-${a.value.actName}-${a.value.scene}`,class:"vue-stage-play__spotlight",ref:r,style:{position:"absolute",scrollMargin:`${a.value.cameraFollowOffset}px`,inset:`-${a.value.spotlightPadding||0}px`,borderRadius:`${a.value.spotlightBorderRadius||0}px`,overflow:"none",pointerEvents:"none"}},[i(se,{css:!1,onEnter:v,onLeave:w},()=>{var n,l,h,s,T,ae;return[S.value?void 0:i("div",{class:"vue-stage-play__voice-over",style:Ie.value,ref:u},[((n=o.voiceOver)==null?void 0:n.call(o,y))||i("div",{class:"default__voice-over",style:{width:`${a.value.voiceOverWidth}px`,margin:"8px",borderRadius:"8px",boxShadow:"0 0 8px rgba(0, 0, 0, 0.2)",backgroundColor:"#fff"}},[i("div",{class:"default__voice-over__header",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:"1px solid #ddd",fontSize:"16px",fontWeight:"bold",lineHeight:"1"}},[((l=o.voHeader)==null?void 0:l.call(o,y))||i("div",{class:"efault__voice-over__header__content",style:{flexGrow:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},a.value.voiceOverTitle),((h=o.voCloseIcon)==null?void 0:h.call(o,y))||i("svg",{class:"default__voice-over__header__close",style:{position:"relative",flexShrink:"0",right:"-4px",display:"block",width:"24px",height:"24px",color:H.value?"#292929":"#7e7e7e",cursor:"pointer",transition:"all 0.2s ease-in-out"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",onMouseenter:()=>{H.value=!0},onMouseleave:()=>{H.value=!1},onClick:()=>C()},[i("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})])]),i("div",{class:"default__voice-over__body",style:{position:"relative",boxSizing:"border-box",minHeight:"60px",padding:"12px",fontSize:"14px",lineHeight:"1.5",textAlign:"center",whiteSpace:"pre-wrap"}},[((s=o.voBody)==null?void 0:s.call(o,y))||a.value.voiceOverContent]),i("div",{class:"default__voice-over__footer",style:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderTop:"1px solid #ddd"}},[((T=o.voFooter)==null?void 0:T.call(o,y))||i("div",{class:"default__voice-over__footer__scene",style:{fontSize:"14px",color:"#7e7e7e"}},`${A.value+1} / ${g.value}`),((ae=o.voFooterButton)==null?void 0:ae.call(o,y))||i("div",{class:"default__voice-over__footer__btns",style:{display:"flex",gap:"8px"}},[b.value&&i("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:Le.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>G()},a.value.voiceOverPrevButtonText),N.value&&i("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:$e.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>U()},a.value.voiceOverNextButtonText),!N.value&&i("button",{class:"default__voice-over__footer__btn",style:{padding:"6px 16px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",fontWeight:"normal",lineHeight:"16px",color:"#292929",backgroundColor:ze.value?"#ddd":"#f1f1f1",transition:"all 0.2s ease-in-out",cursor:"pointer"},onClick:()=>C()},a.value.voiceOverDoneButtonText)])])])])]})]):void 0,_.value&&S.value?i(E,{to:"body"},[i("div",{class:"vue-stage-play__scene__scroll-mask",style:{position:"fixed",top:"0",left:"0",width:"150vw",height:"100vh",zIndex:"99999",overflow:"auto",overscrollBehavior:"none"}},[i("div",{style:{width:"100%",height:"300%"}})])]):void 0,_.value?i(E,{to:"body"},[i("div",{style:{position:"fixed",top:0,left:0,zIndex:99997,width:"100vw",height:"100vh"},onClick:()=>{a.value.allowLeave&&C()}})]):void 0])}}});export{Qe as S,Ke as a,Ye as u};
